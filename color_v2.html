<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cade's Color Manager</title>
    <!-- Mobile & PWA Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#3498db">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Inline Manifest via Data URL (URL-encoded JSON) -->
    <link rel="manifest"
          href="data:application/manifest+json,%7B%22name%22%3A%22Cade%27s%20Color%20Manager%22%2C%22short_name%22%3A%22ColorMgr%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23ffffff%22%2C%22theme_color%22%3A%22%233498db%22%7D">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap"
          rel="stylesheet">
    <!-- Chroma.js for color math -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<style>
    :root {
        --surface-primary: #0f172a;
        --surface-secondary: #1e293b;
        --surface-tertiary: #334155;
        --surface-quaternary: #475569;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-tertiary: #94a3b8;
        --accent-primary: teal;
        --accent-secondary: #437572;
        --accent-tertiary: #24403d;
        --green: #10b981;
        --red: #ef4444;
        --yellow: #eab308;
        --purple: #8b5cf6;
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --transition-all: all 0.2s ease;
        --font-mono: 'JetBrains Mono', monospace;
        --font-sans: 'Inter', sans-serif;
        --accent-color: #000000;
        --after-color: #000000;
    }


    /* Base styling */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: var(--font-sans);
        background: var(--surface-primary);
        color: var(--text-primary);
        line-height: 1.5;
        overflow-x: hidden;
        transition: var(--transition-all);
        padding: 0;
        margin: 0;
    }

    .app-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        width: 100%;
    }

    .header {
        padding: 0.75rem 2rem;
        background: var(--surface-secondary);
        border-bottom: 1px solid var(--surface-tertiary);
        position: sticky;
        top: 0;
        z-index: 10;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .header h1 span.highlight {
        color: var(--accent-primary);
    }

    .theme-toggle {
        background: var(--surface-tertiary);
        border: none;
        color: var(--text-secondary);
        padding: 0.5rem;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition-all);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .theme-toggle:hover {
        background: var(--surface-quaternary);
        color: var(--text-primary);
    }

    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        gap: 1.5rem;
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
    }

    .card {
        background: var(--surface-secondary);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        transition: var(--transition-all);
        border: 1px solid var(--surface-tertiary);
    }

    .card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-0px);
    }

    .card-header {
        padding: 1.25rem 1.5rem;
        background: var(--surface-tertiary);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .card-header h2 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-header h2 .icon {
        opacity: 0.8;
    }

    .card-body {
        padding: 1.5rem;
    }

    /* Color Input Styles */
    .input-group {
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .input-group:last-child {
        margin-bottom: 0;
    }

    .input-group label {
        flex: 0 0 80px;
        font-size: 0.875rem;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .input-wrapper {
        position: relative;
        flex: 1;
        display: flex;
        align-items: center;
    }

    .input-wrapper input {
        width: 100%;
        padding: 0.625rem 0.875rem;
        background: var(--surface-primary);
        color: var(--text-primary);
        border: 1px solid var(--surface-quaternary);
        border-radius: var(--radius-md);
        font-family: var(--font-mono);
        font-size: 0.875rem;
        transition: var(--transition-all);
    }

    .input-wrapper input:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }

    .input-wrapper input.error {
        border-color: var(--red);
    }

    .copy-btn {
        position: absolute;
        right: 0.5rem;
        background: transparent;
        border: none;
        color: var(--text-tertiary);
        cursor: pointer;
        padding: 0.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition-all);
    }

    .copy-btn:hover {
        color: var(--text-primary);
    }

    .error-msg {
        color: var(--red);
        font-size: 0.75rem;
        margin-top: 0.25rem;
        font-weight: 500;
    }

    /* Color Picker */
    input[type="color"] {
        -webkit-appearance: none;
        appearance: none;
        background: transparent;
        cursor: pointer;
    }

    .color-picker-popup {
        position: absolute;
        z-index: 1000;
        background: var(--surface-secondary);
        border: 1px solid var(--surface-tertiary);
        border-radius: var(--radius-md);
        padding: 1rem;
        box-shadow: var(--shadow-lg);
        display: none;
        width: 280px;
    }

    .color-picker-popup.active {
        display: block;
    }

    .alpha-slider-container {
        margin-top: 0.75rem;
        width: 100%;
    }

    .alpha-slider {
        width: 100%;
        height: 20px;
        position: relative;
        margin-top: 0.5rem;
    }

    .alpha-slider input[type="range"] {
        width: 100%;
        position: relative;
        z-index: 2;
        background: transparent;
        appearance: none;
        outline: none;
        transition: var(--transition-all);
        accent-color: var(--after-color);
    }

    .alpha-background {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: linear-gradient(45deg, #ccc 25%, transparent 25%),
        linear-gradient(-45deg, #ccc 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #ccc 75%),
        linear-gradient(-45deg, transparent 75%, #ccc 75%);
        background-size: 10px 10px;
        background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
        border-radius: var(--radius-sm);
    }

    .alpha-gradient {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
        border-radius: var(--radius-sm);
    }

    .color-picker-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .color-display {
        height: 140px;
        border-radius: var(--radius-lg);
        position: relative;
        overflow: hidden;
        transition: var(--transition-all);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .color-display .color-hex {
        font-family: var(--font-mono);
        font-size: 1.5rem;
        font-weight: 600;
        text-shadow: 0 0 10px rgba(0, 0, 0, 0.25);
    }

    .picker-controls {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .color-picker-input {
        flex: 1;
        position: relative;
    }

    .color-picker-input input[type="color"] {
        width: 100%;
        height: 50px;
        border: none;
        border-radius: var(--radius-md);
        background: var(--surface-tertiary);
        cursor: pointer;
        box-shadow: var(--shadow-sm);
        transition: var(--transition-all);
    }

    .color-picker-input input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
    }

    .color-picker-input input[type="color"]::-webkit-color-swatch {
        border: none;
        border-radius: var(--radius-md);
    }

    .btn {
        background: var(--surface-tertiary);
        color: var(--text-primary);
        border: none;
        border-radius: var(--radius-md);
        padding: 0.75rem 1.25rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: var(--transition-all);
        height: 50px;
        font-family: var(--font-sans);
    }

    .btn:hover {
        background: var(--surface-quaternary);
        transform: translateY(-1px);
    }

    .btn-primary {
        background: var(--accent-primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--accent-secondary);
    }

    .btn-danger {
        background: var(--red);
        color: white;
    }

    .btn-danger:hover {
        background: #dc2626;
    }

    .btn-icon {
        width: 50px;
        min-width: 50px;
        padding: 0;
        justify-content: center;
    }

    #recomputeFilterBtn {
        display: flex;
        justify-content: center;
    }

    /* CSS Filter */
    .filter-section {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }

    .filter-info {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }

    .filter-tag {
        background: var(--surface-tertiary);
        padding: 0.5rem 1rem;
        border-radius: var(--radius-lg);
        font-family: var(--font-mono);
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .filter-tag span {
        color: var(--text-tertiary);
    }

    .filter-tag.highlight {
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .filter-examples {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .icon-container {
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 1.5rem;
        background: var(--surface-primary);
        border-radius: var(--radius-lg);
    }

    .icon-container svg {
        width: 64px;
        height: 64px;
    }

    .loss-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--surface-primary);
        border-radius: var(--radius-md);
    }

    .loss-value {
        font-family: var(--font-mono);
        font-weight: 500;
    }

    .loss-message {
        font-weight: 500;
    }

    /* Advanced Filter Controls */
    .advanced-filter-controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
    }

    /* Preview Section */
    .preview-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .preview-button {
        width: 50%;
        padding: 1rem 1.5rem;
        font-size: 1rem;
        font-weight: 500;
        border: none;
        border-radius: var(--radius-md);
        transition: var(--transition-all);
        text-align: center;
    }

    .preview-text-container {
        background: var(--surface-primary);
        padding: 1.5rem;
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .contrast-info {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 0.5rem;
    }

    .contrast-tag {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--surface-primary);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
    }

    .contrast-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }

    /* Palette and Harmonies */
    .palette-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .color-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .color-swatch {
        aspect-ratio: 1/1;
        border-radius: var(--radius-md);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition: var(--transition-all);
        border: 2px solid transparent;
    }

    .color-swatch:hover {
        transform: scale(1.05);
        border-color: var(--text-primary);
        box-shadow: var(--shadow-md);
    }

    .harmony-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .harmony-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .harmony-group h3 {
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Gradient */
    .gradient-controls {
        margin-bottom: 1.5rem;
    }

    .slider-group {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        margin-bottom: 1rem;
    }

    .slider-group label {
        flex: 0 0 140px;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .slider-input {
        flex: 1;
        position: relative;
    }

    .slider-input input[type="range"] {
        width: 100%;
        height: 6px;
        background: var(--surface-tertiary);
        border-radius: var(--radius-sm);
        appearance: none;
        outline: none;
        transition: var(--transition-all);
    }

    .slider-input input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 18px;
        height: 18px;
        background: var(--accent-primary);
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition-all);
    }

    .slider-input input[type="range"]::-webkit-slider-thumb:hover {
        background: var(--accent-secondary);
        transform: scale(1.1);
    }

    .gradient-display {
        display: flex;
        height: 80px;
        border-radius: var(--radius-lg);
        overflow: hidden;
        margin-top: 1rem;
    }

    .gradient-swatch {
        flex: 1;
        cursor: pointer;
        transition: var(--transition-all);
        position: relative;
    }

    .gradient-swatch:hover {
        transform: scale(1.02);
        z-index: 1;
        box-shadow: var(--shadow-md);
    }

    /* Grid */
    .grid-display {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 4px;
        margin-top: 1.5rem;
        border-radius: var(--radius-lg);
        overflow: hidden;
        padding: 16px;
        background: var(--surface-tertiary);
    }

    .grid-cell {
        aspect-ratio: 1/1;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition-all);
    }

    .grid-cell:hover {
        transform: scale(1.1);
        z-index: 1;
        box-shadow: var(--shadow-md);
    }

    /* History */
    .history-header {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        align-items: center;
    }

    .two-column {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
    }

    @media (max-width: 1200px) {
        .two-column {
            grid-template-columns: 1fr;
        }
    }

    /* Vibe selector */
    .select-group {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .select-group label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        min-width: 120px;
    }

    .select-wrapper {
        position: relative;
        flex: 1;
    }

    .select-wrapper select {
        width: 100%;
        padding: 0.75rem 1rem;
        background: var(--surface-primary);
        color: var(--text-primary);
        border: 1px solid var(--surface-quaternary);
        border-radius: var(--radius-md);
        appearance: none;
        font-family: var(--font-sans);
        transition: var(--transition-all);
    }

    .select-wrapper::after {
        content: "";
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid var(--text-tertiary);
        pointer-events: none;
    }

    .select-wrapper select:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    /* Hotkeys section */
    .hotkeys-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 0.75rem;
    }

    .hotkey-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        background: var(--surface-primary);
        border-radius: var(--radius-md);
    }

    .hotkey-combo {
        display: flex;
        gap: 0.25rem;
        align-items: center;
    }

    .key {
        background: var(--surface-tertiary);
        color: var(--text-secondary);
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius-sm);
        font-family: var(--font-mono);
        font-size: 0.75rem;
        min-width: 1.75rem;
        text-align: center;
    }

    .key-plus {
        color: var(--text-tertiary);
    }

    .hotkey-description {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    /* Footer */
    .footer {
        padding: 1.5rem;
        text-align: center;
        background: var(--surface-secondary);
        border-top: 1px solid var(--surface-tertiary);
        color: var(--text-tertiary);
        font-size: 0.875rem;
    }

    /* Animations */
    @keyframes pulse {
        0% {
            opacity: 0.6;
        }
        50% {
            opacity: 1;
        }
        100% {
            opacity: 0.6;
        }
    }

    /* Notification */
    .notification {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--surface-secondary);
        color: var(--text-primary);
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-md);
        opacity: 0;
        animation: fadeInOut 3s forwards;
        z-index: 1000;
    }

    @keyframes fadeInOut {
        0% {
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
        }
        10% {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        90% {
            opacity: 1;
        }
        100% {
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
        }
    }

    /* NEW STYLES FOR ADDED FEATURES */

    /* Shadow Generator */
    .shadow-preview {
        width: 100%;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--surface-primary);
        border-radius: var(--radius-lg);
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
    }

    .shadow-box {
        width: 100px;
        height: 100px;
        border-radius: 8px;
        position: relative;
        transition: all 0.3s ease;
    }

    .shadow-controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .shadow-type-options {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .shadow-option {
        padding: 0.75rem 1rem;
        background: var(--surface-primary);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.2s ease;
        flex: 1;
        text-align: center;
    }

    .shadow-option.active {
        background: var(--accent-primary);
        color: white;
    }

    .shadow-controls .color-option {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    /* Color Mixer */
    .color-mixer-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .color-input {
        flex: 1;
        min-width: 150px;
    }

    .color-input label {
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .color-input input[type="color"] {
        width: 100%;
        height: 40px;
        border: none;
        border-radius: var(--radius-md);
        background: var(--surface-tertiary);
        cursor: pointer;
    }

    .gradient-preview {
        height: 100px;
        width: 80% !important;
        border-radius: var(--radius-lg);
        margin: 1.5rem 0;
        background: linear-gradient(to right, #3498db, #e74c3c);
    }

    .gradient-options {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .gradient-type {
        padding: 0.5rem 1rem;
        background: var(--surface-primary);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .gradient-type.active {
        background: var(--accent-primary);
        color: white;
    }

    /* Mode Toggle Viewer */
    .mode-toggle-preview {
        position: relative;
        height: 200px;
        border-radius: var(--radius-lg);
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .mode-toggle-half {
        position: absolute;
        width: 50%;
        height: 100%;
        top: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .modeHex {
        font-weight: normal;
    }

    .mode-toggle-light {
        left: 0;
        background-color: #f8fafc;
        color: #0f172a;
    }

    .mode-toggle-dark {
        right: 0;
        background-color: #0f172a;
        color: #f8fafc;
    }

    .mode-toggle-divider {
        position: absolute;
        left: 50%;
        top: 0;
        width: 2px;
        height: 100%;
        background-color: var(--surface-tertiary);
        z-index: 2;
    }

    .mode-toggle-control {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--accent-primary);
        cursor: pointer;
        z-index: 3;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }

    .mode-colors-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .mode-color-box {
        padding: 1rem;
        border-radius: var(--radius-md);
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        align-items: center;
        background: var(--surface-primary);
    }

    .mode-color-swatch {
        width: 60px;
        height: 60px;
        border-radius: var(--radius-md);
        border: 2px solid var(--surface-tertiary);
        cursor: pointer;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .header {
            padding: 1rem;
        }

        .header h1 {
            font-size: 1.25rem;
        }

        .main-content {
            padding: 1rem;
            gap: 1rem;
        }

        .card-header {
            padding: 1rem;
        }

        .card-body {
            padding: 1rem;
        }

        .input-group {
            flex-direction: column;
            align-items: flex-start;
        }

        .input-group label {
            margin-bottom: 0.25rem;
            flex: none;
        }

        .input-wrapper {
            width: 100%;
        }

        .palette-controls {
            flex-direction: column;
        }
    }

    .light-mode #title-highlight {
        color: teal;
    }

    #title-highlight {
        color: #7db5b2;
    }

    .preview-section {
        margin-bottom: 1.5rem;
        border-bottom: 1px solid var(--surface-tertiary);
        padding-bottom: 1.5rem;
    }

    .preview-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .preview-section-title {
        font-size: 0.875rem;
        color: var(--text-tertiary);
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .preview-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        align-items: center;
    }

    .preview-button-outline {
        padding: 0.75rem 1.5rem;
        background: transparent;
        border: 2px solid;
        border-radius: var(--radius-md);
        font-weight: 500;
        cursor: pointer;
    }

    .preview-checkbox-container, .preview-radio-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .preview-pill {
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .preview-badge {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .preview-toggle {
        position: relative;
        display: inline-block;
    }

    .toggle-checkbox {
        height: 0;
        width: 0;
        visibility: hidden;
        position: absolute;
    }

    .toggle-label {
        cursor: pointer;
        width: 50px;
        height: 24px;
        background: var(--surface-tertiary);
        display: block;
        border-radius: 100px;
        position: relative;
    }

    .toggle-label:after {
        content: '';
        position: absolute;
        top: 3px;
        left: 3px;
        width: 18px;
        height: 18px;
        background: var(--after-color);
        border-radius: 90px;
        transition: 0.3s;
    }

    .toggle-checkbox:checked + .toggle-label:after {
        left: calc(100% - 3px);
        transform: translateX(-100%);
    }

    .preview-progress {
        height: 8px;
        background-color: var(--surface-tertiary);
        border-radius: var(--radius-sm);
        width: 100%;
        overflow: hidden;
    }

    .preview-progress-bar {
        height: 100%;
        width: 65%;
        border-radius: var(--radius-sm);
    }

    .preview-card {
        border-radius: var(--radius-md);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--surface-tertiary);
    }

    .preview-card-header {
        padding: 0.75rem 1rem;
        font-weight: 600;
    }

    .preview-card-body {
        padding: 1rem;
        background: var(--surface-primary);
    }

    #previewHeading {
        margin-bottom: 0.5rem;
    }

    #previewLink {
        text-decoration: underline;
        margin-top: 0.5rem;
        display: inline-block;
    }

    .border-preview {
        width: 100%;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--surface-primary);
        border-radius: var(--radius-lg);
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
    }

    .border-box {
        width: 150px;
        height: 150px;
        position: relative;
        transition: all 0.3s ease;
    }

    .border-controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    /* Theme Light Mode Overrides */
    .light-mode {
        --surface-primary: #f8fafc;
        --surface-secondary: #f1f5f9;
        --surface-tertiary: #e2e8f0;
        --surface-quaternary: #cbd5e1;
        --text-primary: #0f172a;
        --text-secondary: #1e293b;
        --text-tertiary: #475569;
    }
</style>
<body class="light-mode">
<div class="app-container">
    <header class="header">
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 256 256">
                <path d="M135.88,43.11l-25,143.14a35.71,35.71,0,0,1-41.34,29.2h0a36,36,0,0,1-28.95-41.71l25-143.13a8,8,0,0,1,9.19-6.49l54.67,9.73A8,8,0,0,1,135.88,43.11Z"
                      opacity="0.2"></path>
                <path d="M88,180a12,12,0,1,1-12-12A12,12,0,0,1,88,180Zm152-23.81V208a16,16,0,0,1-16,16H76a46.36,46.36,0,0,1-7.94-.68,44,44,0,0,1-35.43-50.95l25-143.13a15.94,15.94,0,0,1,18.47-13L130.84,26a16,16,0,0,1,12.92,18.52l-12.08,69L199.49,89a16,16,0,0,1,20.45,9.52L239,150.69A18.35,18.35,0,0,1,240,156.19ZM103,184.87,128,41.74,73.46,32l-25,143.1A28,28,0,0,0,70.9,207.57,27.29,27.29,0,0,0,91.46,203,27.84,27.84,0,0,0,103,184.87ZM116.78,195,224,156.11,204.92,104,128.5,131.7l-9.78,55.92A44.63,44.63,0,0,1,116.78,195ZM224,173.12,127.74,208H224Z"></path>
            </svg>
            Cade's <span id="title-highlight" class="highlight">Color Manager</span>
        </h1>
        <button id="themeToggle" class="theme-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>
    </header>

    <main class="main-content">
        <div class="two-column">
            <div class="card">
                <div class="card-header">
                    <h2>
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path
                        d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48 2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48 2.83-2.83"></path></svg>
              </span>
                        Color Manager
                    </h2>
                </div>
                <div class="card-body">
                    <div class="color-picker-container">
                        <div id="colorDisplay" class="color-display">
                            <div id="colorHex" class="color-hex">#3498db</div>
                        </div>
                        <div class="picker-controls">
                            <div class="color-picker-input">
                                <input type="color" id="colorPicker" value="#3498db">
                                <div class="alpha-slider-container">
                                    <label for="alphaSlider">Opacity: <span id="alphaValue">100%</span></label>
                                    <div class="alpha-slider">

                                        <div class="alpha-gradient" id="alphaGradient"></div>
                                        <input type="range" class='slider-input' id="alphaSlider" min="0" max="100"
                                               value="100">
                                    </div>
                                </div>
                            </div>
                            <div style="display:flex;flex-direction:column;gap:1rem;">
                                <button id="eyeDropperBtn" class="btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                         viewBox="0 0 256 256">
                                        <path d="M207.8,87.6l-25.37,25.53,4.89,4.88a16,16,0,0,1,0,22.64l-9,9a8,8,0,0,1-11.32,0l-60.68-60.7a8,8,0,0,1,0-11.32l9-9a16,16,0,0,1,22.63,0l4.88,4.89,25-25.11c10.79-10.79,28.37-11.45,39.45-1A28,28,0,0,1,207.8,87.6Z"
                                              opacity="0.2"></path>
                                        <path d="M224,67.3a35.79,35.79,0,0,0-11.26-25.66c-14-13.28-36.72-12.78-50.62,1.13L142.8,62.2a24,24,0,0,0-33.14.77l-9,9a16,16,0,0,0,0,22.64l2,2.06-51,51a39.75,39.75,0,0,0-10.53,38l-8,18.41A13.68,13.68,0,0,0,36,219.3a15.92,15.92,0,0,0,17.71,3.35L71.23,215a39.89,39.89,0,0,0,37.06-10.75l51-51,2.06,2.06a16,16,0,0,0,22.62,0l9-9a24,24,0,0,0,.74-33.18l19.75-19.87A35.75,35.75,0,0,0,224,67.3ZM97,193a24,24,0,0,1-24,6,8,8,0,0,0-5.55.31l-18.1,7.91L57,189.41a8,8,0,0,0,.25-5.75A23.88,23.88,0,0,1,63,159l51-51,33.94,34ZM202.13,82l-25.37,25.52a8,8,0,0,0,0,11.3l4.89,4.89a8,8,0,0,1,0,11.32l-9,9L112,83.26l9-9a8,8,0,0,1,11.31,0l4.89,4.89a8,8,0,0,0,5.65,2.34h0a8,8,0,0,0,5.66-2.36l24.94-25.09c7.81-7.82,20.5-8.18,28.29-.81a20,20,0,0,1,.39,28.7Z"></path>
                                    </svg>
                                    Eye Dropper
                                </button>
                                <button id="randomColorBtn" class="btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <polyline points="16 3 21 3 21 8"></polyline>
                                        <line x1="4" y1="20" x2="21" y2="3"></line>
                                        <polyline points="21 16 21 21 16 21"></polyline>
                                        <line x1="3" y1="4" x2="21" y2="21"></line>
                                    </svg>
                                    Random Color
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="input-section">
                        <div class="input-group">
                            <label for="hexInput">Hex</label>
                            <div class="input-wrapper">
                                <input type="text" id="hexInput" placeholder="#RRGGBB">
                                <button class="copy-btn" data-target="hexInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="hexError"></div>
                        </div>

                        <div class="input-group">
                            <label for="rgbaInput">RGBA</label>
                            <div class="input-wrapper">
                                <input type="text" id="rgbaInput" placeholder="rgba(255,0,0,1)">
                                <button class="copy-btn" data-target="rgbaInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="rgbaError"></div>
                        </div>

                        <div class="input-group">
                            <label for="hslInput">HSL</label>
                            <div class="input-wrapper">
                                <input type="text" id="hslInput" placeholder="hsl(0,100%,50%)">
                                <button class="copy-btn" data-target="hslInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="hslError"></div>
                        </div>

                        <div class="input-group">
                            <label for="labInput">Lab</label>
                            <div class="input-wrapper">
                                <input type="text" id="labInput" placeholder="lab(53, 80, 67)">
                                <button class="copy-btn" data-target="labInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="labError"></div>
                        </div>

                        <div class="input-group">
                            <label for="lchInput">LCH</label>
                            <div class="input-wrapper">
                                <input type="text" id="lchInput" placeholder="lch(53, 80, 67)">
                                <button class="copy-btn" data-target="lchInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="lchError"></div>
                        </div>

                        <div class="input-group">
                            <label for="cmykInput">CMYK</label>
                            <div class="input-wrapper">
                                <input type="text" id="cmykInput" placeholder="cmyk(0%, 50%, 50%, 0%)">
                                <button class="copy-btn" data-target="cmykInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="cmykError"></div>
                        </div>

                        <div class="input-group">
                            <label for="filterInput">CSS Filter</label>
                            <div class="input-wrapper">
                                <input type="text" id="filterInput" placeholder="invert(0%) hue-rotate(0deg)">
                                <button class="copy-btn" data-target="filterInput" title="Copy to clipboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="error-msg" id="filterError"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path
                        d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline
                        points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
              </span>
                        Saved Colors
                    </h2>
                </div>
                <div class="card-body">
                    <div class="palette-controls">
                        <button id="savePaletteBtn" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <path d="M12 20v-8m0 0V4m0 8h8m-8 0H4"></path>
                            </svg>
                            Save Current Color
                        </button>
                        <button id="clearPaletteBtn" class="btn btn-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                            </svg>
                            Clear Palette
                        </button>
                    </div>
                    <div class="color-grid" id="savedPalettes"></div>
                </div>
            </div>
        </div>

        <!-- CSS Filter Generator -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 256 256"><path
                      d="M208,88H152V32Z" opacity="0.2"></path><path
                      d="M48,180c0,11,7.18,20,16,20a14.2,14.2,0,0,0,10.22-4.66A8,8,0,1,1,85.77,206.4,30,30,0,0,1,64,216c-17.65,0-32-16.15-32-36s14.35-36,32-36a30,30,0,0,1,21.77,9.6,8,8,0,1,1-11.55,11.06A14.24,14.24,0,0,0,64,160C55.18,160,48,169,48,180Zm79.6-8.69c-4-1.16-8.14-2.35-10.45-3.84-1.26-.81-1.23-1-1.12-1.9a4.54,4.54,0,0,1,2-3.67c4.6-3.12,15.35-1.73,19.83-.56a8,8,0,0,0,4.07-15.48c-2.12-.55-21-5.22-32.83,2.76a20.55,20.55,0,0,0-9,14.95c-2,15.88,13.64,20.41,23,23.11,12.07,3.49,13.13,4.92,12.78,7.59-.31,2.41-1.26,3.34-2.14,3.93-4.6,3.06-15.17,1.56-19.55.36a8,8,0,0,0-4.3,15.41,61.23,61.23,0,0,0,15.18,2c5.83,0,12.3-1,17.49-4.46a20.82,20.82,0,0,0,9.19-15.23C154,179,137.48,174.17,127.6,171.31Zm64,0c-4-1.16-8.14-2.35-10.45-3.84-1.25-.81-1.23-1-1.12-1.9a4.54,4.54,0,0,1,2-3.67c4.6-3.12,15.34-1.73,19.82-.56a8,8,0,0,0,4.07-15.48c-2.11-.55-21-5.22-32.83,2.76a20.58,20.58,0,0,0-8.95,14.95c-2,15.88,13.65,20.41,23,23.11,12.06,3.49,13.12,4.92,12.78,7.59-.31,2.41-1.26,3.34-2.15,3.93-4.6,3.06-15.16,1.56-19.54.36A8,8,0,0,0,173.93,214a61.34,61.34,0,0,0,15.19,2c5.82,0,12.3-1,17.49-4.46a20.81,20.81,0,0,0,9.18-15.23C218,179,201.48,174.17,191.59,171.31ZM40,112V40A16,16,0,0,1,56,24h96a8,8,0,0,1,5.66,2.34l56,56A8,8,0,0,1,216,88v24a8,8,0,1,1-16,0V96H152a8,8,0,0,1-8-8V40H56v72a8,8,0,0,1-16,0ZM160,80h28.68L160,51.31Z"></path></svg>
            </span>
                    CSS Filter Generator
                </h2>
            </div>
            <div class="card-body">
                <div class="filter-section">
                    <div class="filter-info">
                        <div class="filter-tag">
                            <span>Target:</span>
                            <span id="cssTargetColor">#3498db</span>
                        </div>
                        <div class="filter-tag highlight">
                            <span>Filter:</span>
                            <span id="computedFilter">invert(0%) hue-rotate(0deg)</span>
                        </div>
                        <div class="loss-indicator">
                            <div id="filterLoss" class="loss-value">Loss: 0.00</div>
                            <span>â‡’</span>
                            <div id="lossString" class="loss-message">No loss</div>
                        </div>
                    </div>

                    <div class="filter-examples">
                        <div class="icon-container" id="icon-container">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#000000"
                                 viewBox="0 0 256 256">
                                <path d="M224,64H154.67L126.93,43.2a16.12,16.12,0,0,0-9.6-3.2H72A16,16,0,0,0,56,56V72H40A16,16,0,0,0,24,88V200a16,16,0,0,0,16,16H192.89A15.13,15.13,0,0,0,208,200.89V184h16.89A15.13,15.13,0,0,0,240,168.89V80A16,16,0,0,0,224,64Zm0,104H208V112a16,16,0,0,0-16-16H122.67L94.93,75.2a16.12,16.12,0,0,0-9.6-3.2H72V56h45.33L147.2,78.4A8,8,0,0,0,152,80h72Z"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#000000"
                                 viewBox="0 0 256 256">
                                <path d="M80,192a8,8,0,0,1-8,8H32a8,8,0,0,1,0-16H72A8,8,0,0,1,80,192Zm144-8H184a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm-72,0H104a8,8,0,0,0,0,16h48a8,8,0,0,0,0-16ZM32,168h80a8,8,0,0,0,0-16H32a8,8,0,0,0,0,16Zm192-16H144a8,8,0,0,0,0,16h80a8,8,0,0,0,0-16Zm0-96H32a8,8,0,0,0-8,8V88a8,8,0,0,0,8,8H224a8,8,0,0,0,8-8V64A8,8,0,0,0,224,56Zm0,56H32a8,8,0,0,0-8,8v8a8,8,0,0,0,8,8H224a8,8,0,0,0,8-8v-8A8,8,0,0,0,224,112Z"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#000000"
                                 viewBox="0 0 256 256">
                                <path d="M254.88,195.92l-54.56-92.08A15.87,15.87,0,0,0,186.55,96h0a15.85,15.85,0,0,0-13.76,7.84l-15.64,26.39a4,4,0,0,0,0,4.07l26.8,45.47a8.13,8.13,0,0,1-1.89,10.55,8,8,0,0,1-11.8-2.26L101.79,71.88a16,16,0,0,0-27.58,0L1.11,195.94a8,8,0,0,0,1,9.52A8.23,8.23,0,0,0,8.23,208H247.77a8.29,8.29,0,0,0,6.09-2.55A8,8,0,0,0,254.88,195.92ZM64.43,120,88,80l23.57,40ZM140,52a24,24,0,1,1,24,24A24,24,0,0,1,140,52Z"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#000000"
                                 viewBox="0 0 256 256">
                                <path d="M224,44H32A12,12,0,0,0,20,56V192a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A12,12,0,0,0,224,44Zm-96,83.72L62.85,68h130.3ZM92.79,128,44,172.72V83.28Zm17.76,16.28,9.34,8.57a12,12,0,0,0,16.22,0l9.34-8.57L193.15,188H62.85ZM163.21,128,212,83.28v89.44Z"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#000000"
                                 viewBox="0 0 256 256">
                                <path d="M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,187a113.4,113.4,0,0,1-20.39-35h40.82a116.94,116.94,0,0,1-10,20.77A108.61,108.61,0,0,1,128,207Zm-26.49-59a135.42,135.42,0,0,1,0-40h53a135.42,135.42,0,0,1,0,40ZM44,128a83.49,83.49,0,0,1,2.43-20H77.25a160.63,160.63,0,0,0,0,40H46.43A83.49,83.49,0,0,1,44,128Zm84-79a113.4,113.4,0,0,1,20.39,35H107.59a116.94,116.94,0,0,1,10-20.77A108.61,108.61,0,0,1,128,49Zm50.73,59h30.82a83.52,83.52,0,0,1,0,40H178.75a160.63,160.63,0,0,0,0-40Zm20.77-24H173.71a140.82,140.82,0,0,0-15.5-34.36A84.51,84.51,0,0,1,199.52,84ZM97.79,49.64A140.82,140.82,0,0,0,82.29,84H56.48A84.51,84.51,0,0,1,97.79,49.64ZM56.48,172H82.29a140.82,140.82,0,0,0,15.5,34.36A84.51,84.51,0,0,1,56.48,172Zm101.73,34.36A140.82,140.82,0,0,0,173.71,172h25.81A84.51,84.51,0,0,1,158.21,206.36Z"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="advanced-filter-controls">
                        <div class="slider-group">
                            <label for="filterInvert">Invert</label>
                            <div class="slider-input">
                                <input type="range" id="filterInvert" min="0" max="100" value="0">
                            </div>
                        </div>
                        <div class="slider-group">
                            <label for="filterSepia">Sepia</label>
                            <div class="slider-input">
                                <input type="range" id="filterSepia" min="0" max="100" value="0">
                            </div>
                        </div>
                        <div class="slider-group">
                            <label for="filterSaturate">Saturate</label>
                            <div class="slider-input">
                                <input type="range" id="filterSaturate" min="0" max="300" value="100">
                            </div>
                        </div>
                        <div class="slider-group">
                            <label for="filterHue">Hueâ€‘Rotate</label>
                            <div class="slider-input">
                                <input type="range" id="filterHue" min="0" max="360" value="0">
                            </div>
                        </div>
                        <div class="slider-group">
                            <label for="filterBrightness">Brightness</label>
                            <div class="slider-input">
                                <input type="range" id="filterBrightness" min="0" max="200" value="100">
                            </div>
                        </div>
                        <div class="slider-group">
                            <label for="filterContrast">Contrast</label>
                            <div class="slider-input">
                                <input type="range" id="filterContrast" min="0" max="200" value="100">
                            </div>
                        </div>
                    </div>

                    <button id="recomputeFilterBtn" class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                            <path d="M21 3v5h-5"></path>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                            <path d="M8 16H3v5"></path>
                        </svg>
                        Recompute Filter
                    </button>
                </div>
            </div>
        </div>

        <!-- Live Preview -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 256 256"><path
                      d="M224,64v88H32V64A16,16,0,0,1,48,48H208A16,16,0,0,1,224,64Z" opacity="0.2"></path><path
                      d="M208,40H48A24,24,0,0,0,24,64V176a24,24,0,0,0,24,24h72v16H96a8,8,0,0,0,0,16h64a8,8,0,0,0,0-16H136V200h72a24,24,0,0,0,24-24V64A24,24,0,0,0,208,40ZM48,56H208a8,8,0,0,1,8,8v80H40V64A8,8,0,0,1,48,56ZM208,184H48a8,8,0,0,1-8-8V160H216v16A8,8,0,0,1,208,184Z"></path></svg>
            </span>
                    Live Preview
                </h2>
            </div>
            <div class="card-body">
                <div class="preview-container">
                    <!-- Basic UI Elements -->
                    <div class="preview-section">
                        <h3 class="preview-section-title">Basic UI Elements</h3>
                        <div class="preview-row">
                            <button id="previewButton" class="preview-button">Sample Button</button>
                            <button id="previewButtonOutline" class="preview-button-outline">Outline Button</button>
                        </div>

                        <div class="preview-row">
                            <div class="preview-checkbox-container">
                                <input type="checkbox" id="previewCheckbox" checked>
                                <label for="previewCheckbox">Checkbox</label>
                            </div>

                            <div class="preview-radio-container">
                                <input type="radio" id="previewRadio" name="radioGroup" checked>
                                <label for="previewRadio">Radio Button</label>
                            </div>
                        </div>

                        <div class="preview-row">
                            <div class="preview-pill">Pill Label</div>
                            <div class="preview-badge">8</div>
                        </div>

                        <div class="preview-row">
                            <div class="preview-toggle">
                                <input type="checkbox" id="previewToggle" class="toggle-checkbox">
                                <label for="previewToggle" class="toggle-label"></label>
                            </div>
                            <div class="preview-progress">
                                <div class="preview-progress-bar" id="previewProgressBar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Text Preview -->
                    <div class="preview-section">
                        <h3 class="preview-section-title">Text Styles</h3>
                        <div class="preview-text-container">
                            <h4 id="previewHeading">Heading Text</h4>
                            <p id="previewText">This is sample text in the current color.</p>
                            <p id="previewTextLighter" style="font-weight:lighter">This is sample light text.</p>
                            <p id="previewTextBold" style="font-weight:bold">This is sample bold text.</p>
                            <a href="#" id="previewLink">This is a sample link</a>
                        </div>
                    </div>

                    <!-- Card Preview -->
                    <div class="preview-section">
                        <h3 class="preview-section-title">Card Element</h3>
                        <div class="preview-card" id="previewCard">
                            <div class="preview-card-header" id="previewCardHeader">Card Header</div>
                            <div class="preview-card-body">
                                <p>Card content with some sample text.</p>
                            </div>
                        </div>
                    </div>

                    <div class="contrast-info" id="contrastCheck">
                        <div class="contrast-tag">
                            <div class="contrast-dot" style="background-color: white;"></div>
                            <span>Contrast with white: 1.5</span>
                        </div>
                        <div class="contrast-tag">
                            <div class="contrast-dot" style="background-color: black;"></div>
                            <span>Contrast with black: 10.5</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Color Mixer -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 256 256"><path
                      d="M224,127.17a96.48,96.48,0,0,1-2.39,22.18A24,24,0,0,1,198.21,168H152a24,24,0,0,0-24,24,24,24,0,0,1-32,22.61C58.73,201.44,32,169.81,32,128a96,96,0,0,1,95-96C179.84,31.47,223.55,74.35,224,127.17Z"
                      opacity="0.2"></path><path
                      d="M200.77,53.89A103.27,103.27,0,0,0,128,24h-1.07A104,104,0,0,0,24,128c0,43,26.58,79.06,69.36,94.17A32,32,0,0,0,136,192a16,16,0,0,1,16-16h46.21a31.81,31.81,0,0,0,31.2-24.88,104.43,104.43,0,0,0,2.59-24A103.28,103.28,0,0,0,200.77,53.89Zm13,93.71A15.89,15.89,0,0,1,198.21,160H152a32,32,0,0,0-32,32,16,16,0,0,1-21.31,15.07C62.49,194.3,40,164,40,128a88,88,0,0,1,87.09-88h.9a88.35,88.35,0,0,1,88,87.25A88.86,88.86,0,0,1,213.81,147.6ZM140,76a12,12,0,1,1-12-12A12,12,0,0,1,140,76ZM96,100A12,12,0,1,1,84,88,12,12,0,0,1,96,100Zm0,56a12,12,0,1,1-12-12A12,12,0,0,1,96,156Zm88-56a12,12,0,1,1-12-12A12,12,0,0,1,184,100Z"></path></svg>
              </span>
                    Color Mixer
                </h2>
            </div>
            <div class="card-body">
                <div class="color-mixer-controls">
                    <div class="color-input">
                        <label for="mixColor1">Color 1</label>
                        <input type="color" id="mixColor1" value="#3498db">
                    </div>
                    <div class="color-input">
                        <label for="mixColor2">Color 2</label>
                        <input type="color" id="mixColor2" value="#e74c3c">
                    </div>
                    <div class="color-input" style="display:none">
                        <div style="display:flex;flex-direction:row;align-items:anchor-center;justify-content:space-between">
                            <label for="mixColor3">Color 3 (Optional)</label>
                            <input type="checkbox" id="useColor3">
                        </div>
                        <input type="color" id="mixColor3" value="#2ecc71">
                    </div>
                </div>

                <div class="slider-group" id="mixRatioControl">
                    <label for="mixRatio">Mix Ratio</label>
                    <div class="slider-input">
                        <input type="range" id="mixRatio" min="0" max="100" value="50">
                    </div>
                </div>

                <div style="display:flex; justify-content:center;">
                    <div class="gradient-preview color-swatch" id="gradientMixPreview"></div>
                </div>
                <div class="input-group">
                    <label for="gradientCssOutput">CSS Output</label>
                    <div class="input-wrapper">
                        <input type="text" id="gradientCssOutput" readonly>
                        <button class="copy-btn" data-target="gradientCssOutput" title="Copy to clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gradient Generator -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect
                      width="18" height="18" x="3" y="3" rx="2"></rect><circle cx="12" cy="12" r="5"></circle></svg>
            </span>
                    Gradient Generator
                </h2>
            </div>
            <div class="card-body">
                <div class="color-mixer-controls">
                    <div class="color-input">
                        <label for="gradColor1">Color 1</label>
                        <input type="color" id="gradColor1" value="#3498db">
                    </div>
                    <div class="color-input">
                        <label for="gradColor2">Color 2</label>
                        <input type="color" id="gradColor2" value="#e74c3c">
                    </div>
                    <div class="color-input">
                        <div style="display:flex;flex-direction:row;align-items:anchor-center;justify-content:space-between">
                            <label for="gradColor3">Color 3 (Optional)</label>
                            <input type="checkbox" id="useGradColor3">
                        </div>
                        <input type="color" id="gradColor3" value="#2ecc71">
                    </div>
                </div>

                <div class="gradient-options">
                    <div class="shadow-option" data-gradient-type="linear">Linear Gradient</div>
                    <div class="shadow-option active" data-gradient-type="radial">Radial Gradient</div>
                </div>

                <div class="slider-group">
                    <label for="gradientAngle">Angle (deg)</label>
                    <div class="slider-input">
                        <input type="range" id="gradientAngle" min="0" max="360" value="90">
                    </div>
                </div>

                <div style="display:flex; justify-content:center;">
                    <div class="gradient-preview color-swatch" id="gradientPreview"></div>
                </div>

                <div class="input-group">
                    <label for="gradientOutput">CSS Output</label>
                    <div class="input-wrapper">
                        <input type="text" id="gradientOutput" readonly>
                        <button class="copy-btn" data-target="gradientOutput" title="Copy to clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                            </svg>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- 1D Gradient -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect
                      width="18" height="18" x="3" y="3" rx="2"></rect><circle cx="12" cy="12" r="5"></circle></svg>
            </span>
                    Gradient
                </h2>
            </div>
            <div class="card-body">
                <div class="gradient-controls">
                    <div class="slider-group">
                        <label for="gradientSlider">Intensity</label>
                        <div class="slider-input">
                            <input type="range" id="gradientSlider" min="0" max="100" value="50">
                        </div>
                    </div>
                </div>
                <div class="gradient-display" id="gradientDisplay"></div>
            </div>
        </div>

        <!-- Color Harmonies -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path
                      d="M12 2v8"></path><path d="m4.93 10.93 1.41 1.41"></path><path d="M2 18h2"></path><path
                      d="M20 18h2"></path><path d="m19.07 10.93-1.41 1.41"></path><path d="M22 22H2"></path><path
                      d="m16 6-4 4-4-4"></path><path d="M16 18a4 4 0 0 0-8 0"></path></svg>
            </span>
                    Color Harmonies
                </h2>
            </div>
            <div class="card-body">
                <div class="select-group">
                    <label for="vibeSelect">Adjust Colors by Vibe</label>
                    <div class="select-wrapper">
                        <select id="vibeSelect">
                            <option value="default">None</option>
                            <option value="pastel">Pastel</option>
                            <option value="retro">Retro</option>
                            <option value="cyberpunk">Cyberpunk</option>
                            <option value="vintage">Vintage</option>
                            <option value="vibrant">Vibrant</option>
                            <option value="professional" selected>Professional</option>
                            <option value="earthy">Earthy</option>
                            <option value="neon">Neon</option>
                            <option value="monochrome">Monochrome</option>
                            <option value="warm">Warm</option>
                            <option value="cool">Cool</option>
                        </select>
                    </div>
                </div>
                <div class="harmony-container">
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <path d="M5.5 8.5 9 12l-3.5 3.5L2 12l3.5-3.5Z"></path>
                                <path d="m12 2 3.5 3.5L12 9 8.5 5.5 12 2Z"></path>
                                <path d="M18.5 8.5 22 12l-3.5 3.5L15 12l3.5-3.5Z"></path>
                                <path d="m12 15 3.5 3.5L12 22l-3.5-3.5L12 15Z"></path>
                            </svg>
                            Similar Colors
                        </h3>
                        <div class="color-grid" id="similarColors"></div>
                    </div>
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="4"></circle>
                                <path d="M21.17 8H12"></path>
                            </svg>
                            Complementary Colors
                        </h3>
                        <div class="color-grid" id="complementaryColors"></div>
                    </div>
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <rect width="18" height="18" x="3" y="3" rx="2"></rect>
                                <path d="M12 8v8"></path>
                                <path d="m8.5 14 7-4"></path>
                                <path d="m8.5 10 7 4"></path>
                            </svg>
                            Analogous Colors
                        </h3>
                        <div class="color-grid" id="analogousColors"></div>
                    </div>
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <polygon points="12 2 20 12 12 22 4 12"></polygon>
                            </svg>
                            Triadic Colors
                        </h3>
                        <div class="color-grid" id="triadicColors"></div>
                    </div>
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <rect width="16" height="16" x="4" y="4" rx="2"></rect>
                            </svg>
                            Tetradic Colors
                        </h3>
                        <div class="color-grid" id="tetradicColors"></div>
                    </div>
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <polygon points="2 12 10 6 10 18 2 12"></polygon>
                                <polygon points="22 12 14 6 14 18 22 12"></polygon>
                            </svg>
                            Splitâ€‘Complementary
                        </h3>
                        <div class="color-grid" id="splitColors"></div>
                    </div>
                    <div class="harmony-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 2v20"></path>
                                <path d="M2 12h20"></path>
                            </svg>
                            Luminance Contrast
                        </h3>
                        <div class="color-grid" id="luminanceConstrast"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2D Gradient Grid -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect
                      width="18" height="18" x="3" y="3" rx="2"></rect><path d="M7 8h10M7 12h10M7 16h10"></path></svg>
            </span>
                    2D Gradient Grid
                </h2>
            </div>
            <div class="card-body">
                <div class="gradient-controls">
                    <div class="slider-group">
                        <label for="gridSatSlider">Saturation Variation</label>
                        <div class="slider-input">
                            <input type="range" id="gridSatSlider" min="0" max="100" value="50">
                        </div>
                    </div>
                    <div class="slider-group">
                        <label for="gridLightSlider">Lightness Variation</label>
                        <div class="slider-input">
                            <input type="range" id="gridLightSlider" min="0" max="100" value="30">
                        </div>
                    </div>
                </div>
                <div class="grid-display" id="gridDisplay"></div>
            </div>
        </div>

        <!-- Mode Color Suggestions -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 256 256"><path
                      d="M216,48H40a8,8,0,0,0-8,8V200a8,8,0,0,0,8,8H216a8,8,0,0,0,8-8V56A8,8,0,0,0,216,48ZM128,176c-35.35,0-64-21.49-64-48s28.65-48,64-48,64,21.49,64,48S163.35,176,128,176Z"
                      opacity="0.2"></path><path
                      d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200ZM178.05,87.66C164.59,77.56,146.81,72,128,72S91.41,77.56,78,87.66C63.79,98.27,56,112.6,56,128s7.79,29.73,22,40.34C91.41,178.44,109.19,184,128,184s36.59-5.56,50.05-15.66C192.21,157.73,200,143.4,200,128S192.21,98.27,178.05,87.66ZM128,168c-30.88,0-56-17.94-56-40s25.12-40,56-40,56,17.94,56,40S158.88,168,128,168Z"></path></svg>
              </span>
                    Mode Color Suggestions
                </h2>
            </div>
            <div class="card-body">
                <div class="mode-toggle-preview">
                    <div class="mode-toggle-half mode-toggle-light" id="lightModePreview">
                        Light Mode
                        <div id="lightModeHex" class="modeHex">#ffffff</div>
                    </div>
                    <div class="mode-toggle-half mode-toggle-dark" id="darkModePreview">
                        Dark Mode
                        <div id="darkModeHex" class="modeHex">#000000</div>
                    </div>
                    <div class="mode-toggle-divider"></div>
                </div>
            </div>
        </div>

        <!-- Shadow Generator -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path
                      d="M15 4h3a1 1 0 0 1 1 1v15"></path><path d="M20 17c-6.192.974-9.929 1.382-18.364-4.36"></path><path
                      d="M15 8v.01"></path><path d="M12 8v.01"></path><path d="M9 8v.01"></path><path
                      d="M6 8v.01"></path><path d="M3 8v.01"></path><rect width="12" height="4" x="3" y="4"
                                                                          rx="1"></rect><path d="M4 12h9"></path><path
                      d="M9 12v4"></path><path d="M4 17h4"></path></svg>
              </span>
                    Shadow Generator
                </h2>
            </div>
            <div class="card-body">
                <div class="shadow-preview" id="shadowPreview">
                    <div class="shadow-box" id="shadowBox"></div>
                </div>

                <div class="shadow-controls">
                    <div class="shadow-type-options">
                        <div class="shadow-option active" data-type="outside">Outside Shadow</div>
                        <div class="shadow-option" data-type="inside">Inside Shadow</div>
                    </div>

                    <div class="shadow-type-options">
                        <div class="shadow-option active" data-color-type="color-box">COLOR Box + Shadow</div>
                        <div class="shadow-option" data-color-type="bw-box">Black/White Box + COLOR Shadow</div>
                    </div>

                    <div class="input-group">
                        <label for="shadowColorInput">Shadow Color</label>
                        <div class="input-wrapper">
                            <input type="color" id="shadowColorInput" value="#000000">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="shadowX">X Offset</label>
                        <div class="slider-input">
                            <input type="range" id="shadowX" min="-30" max="30" value="5">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="shadowY">Y Offset</label>
                        <div class="slider-input">
                            <input type="range" id="shadowY" min="-30" max="30" value="5">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="shadowBlur">Blur Radius</label>
                        <div class="slider-input">
                            <input type="range" id="shadowBlur" min="0" max="50" value="10">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="shadowSpread">Spread Radius</label>
                        <div class="slider-input">
                            <input type="range" id="shadowSpread" min="-20" max="50" value="0">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="shadowOpacity">Shadow Opacity</label>
                        <div class="slider-input">
                            <input type="range" id="shadowOpacity" min="0" max="100" value="30">
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="shadowCssOutput">CSS Output</label>
                        <div class="input-wrapper">
                            <input type="text" id="shadowCssOutput" readonly>
                            <button class="copy-btn" data-target="shadowCssOutput" title="Copy to clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round">
                                    <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>
					<span class="icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
						</svg>
					</span>
                    Border Generator
                </h2>
            </div>
            <div class="card-body">
                <div class="border-preview" id="borderPreview">
                    <div class="border-box" id="borderBox"></div>
                </div>

                <div class="border-controls">
                    <div class="shadow-type-options" style="display:none">
                        <div class="shadow-option active" data-border-type="color-border">COLOR Border + Box</div>
                        <div class="shadow-option" data-border-type="color-box">COLOR Box + Border</div>
                    </div>

                    <div class="input-group">
                        <label for="borderColorInput">Border Color</label>
                        <div class="input-wrapper">
                            <input type="color" id="borderColorInput" value="#000000">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="borderWidth">Border Width</label>
                        <div class="slider-input">
                            <input type="range" id="borderWidth" min="1" max="20" value="3">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="borderRadius">Border Radius</label>
                        <div class="slider-input">
                            <input type="range" id="borderRadius" min="0" max="50" value="8">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="borderOpacity">Border Opacity</label>
                        <div class="slider-input">
                            <input type="range" id="borderOpacity" min="0" max="100" value="100">
                        </div>
                    </div>

                    <div class="slider-group">
                        <label for="borderLightness">Border Lightness</label>
                        <div class="slider-input">
                            <input type="range" id="borderLightness" min="-50" max="50" value="0">
                        </div>
                    </div>

                    <div class="select-group">
                        <label for="borderStyle">Border Style</label>
                        <div class="select-wrapper">
                            <select id="borderStyle">
                                <option value="solid">Solid</option>
                                <option value="dashed">Dashed</option>
                                <option value="dotted">Dotted</option>
                                <option value="double">Double</option>
                                <option value="groove">Groove</option>
                                <option value="ridge">Ridge</option>
                                <option value="inset">Inset</option>
                                <option value="outset">Outset</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="borderCssOutput">CSS Output</label>
                        <div class="input-wrapper">
                            <input type="text" id="borderCssOutput" readonly>
                            <button class="copy-btn" data-target="borderCssOutput" title="Copy to clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round">
                                    <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History & Background -->
        <div class="two-column">
            <div class="card">
                <div class="card-header">
                    <h2>
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path
                        d="M3 3v5h5"></path><path d="M3 3 9 9"></path><path d="M21 3v5h-5"></path><path
                        d="m15 9 6-6"></path><path d="M3 21v-5h5"></path><path d="m3 21 6-6"></path><path
                        d="M21 21v-5h-5"></path><path d="m15 15 6 6"></path></svg>
              </span>
                        History
                    </h2>
                </div>
                <div class="card-body">
                    <div class="history-header">
                        <button id="undoBtn" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <path d="M9 14 4 9l5-5"></path>
                                <path d="M4 9h16"></path>
                            </svg>
                            Undo
                        </button>
                        <button id="redoBtn" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round">
                                <path d="m15 14 5-5-5-5"></path>
                                <path d="M4 9h16"></path>
                            </svg>
                            Redo
                        </button>
                    </div>
                    <div class="color-grid" id="historyContainer"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2>
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path
                        d="M21 14V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10"></path><circle cx="18" cy="14"
                                                                                                      r="4"></circle><path
                        d="M18 12v4"></path><path d="M16 14h4"></path></svg>
              </span>
                        Set Background
                    </h2>
                </div>
                <div class="card-body">
                    <div class="history-header">
                        <button id="changeBackground" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                 viewBox="0 0 256 256">
                                <path d="M224,48V152a16,16,0,0,1-16,16H99.31l10.35,10.34a8,8,0,0,1-11.32,11.32l-24-24a8,8,0,0,1,0-11.32l24-24a8,8,0,0,1,11.32,11.32L99.31,152H208V48H96v8a8,8,0,0,1-16,0V48A16,16,0,0,1,96,32H208A16,16,0,0,1,224,48ZM168,192a8,8,0,0,0-8,8v8H48V104H156.69l-10.35,10.34a8,8,0,0,0,11.32,11.32l24-24a8,8,0,0,0,0-11.32l-24-24a8,8,0,0,0-11.32,11.32L156.69,88H48a16,16,0,0,0-16,16V208a16,16,0,0,0,16,16H160a16,16,0,0,0,16-16v-8A8,8,0,0,0,168,192Z"></path>
                            </svg>
                            Change
                        </button>
                        <button id="resetBackground" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                 viewBox="0 0 256 256">
                                <path d="M224,48V96a8,8,0,0,1-8,8H168a8,8,0,0,1,0-16h28.69L182.06,73.37a79.56,79.56,0,0,0-56.13-23.43h-.45A79.52,79.52,0,0,0,69.59,72.71,8,8,0,0,1,58.41,61.27a96,96,0,0,1,135,.79L208,76.69V48a8,8,0,0,1,16,0ZM186.41,183.29a80,80,0,0,1-112.47-.66L59.31,168H88a8,8,0,0,0,0-16H40a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V179.31l14.63,14.63A95.43,95.43,0,0,0,130,222.06h.53a95.36,95.36,0,0,0,67.07-27.33,8,8,0,0,0-11.18-11.44Z"></path>
                            </svg>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hotkeys -->
        <div class="card">
            <div class="card-header">
                <h2>
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect
                      width="18" height="18" x="3" y="3" rx="2"></rect><path d="M7 9h10"></path><path
                      d="M7 12h10"></path><path d="M7 15h10"></path></svg>
            </span>
                    Hotkeys
                </h2>
            </div>
            <div class="card-body">
                <div class="hotkeys-grid">
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Shift</span>
                            <span class="key-plus">+</span>
                            <span class="key">B</span>
                        </div>
                        <span class="hotkey-description">Change Background Color</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Shift</span>
                            <span class="key-plus">+</span>
                            <span class="key">W</span>
                        </div>
                        <span class="hotkey-description">Reset Background Color</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Shift</span>
                            <span class="key-plus">+</span>
                            <span class="key">I</span>
                        </div>
                        <span class="hotkey-description">Toggle Page Inversion</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Shift</span>
                            <span class="key-plus">+</span>
                            <span class="key">L</span>
                        </div>
                        <span class="hotkey-description">Temporarily Invert Page</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Shift</span>
                            <span class="key-plus">+</span>
                            <span class="key">S</span>
                        </div>
                        <span class="hotkey-description">Save Current Color</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Ctrl</span>
                            <span class="key-plus">+</span>
                            <span class="key">Z</span>
                        </div>
                        <span class="hotkey-description">Undo</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Ctrl</span>
                            <span class="key-plus">+</span>
                            <span class="key">Y</span>
                        </div>
                        <span class="hotkey-description">Redo</span>
                    </div>
                    <div class="hotkey-item">
                        <div class="hotkey-combo">
                            <span class="key">Shift</span>
                            <span class="key-plus">+</span>
                            <span class="key">C</span>
                        </div>
                        <span class="hotkey-description">Copy Current Color</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>Cade's Color Manager</p>
    </footer>
</div>
<script>
    /***********************
     * Global Variables
     ***********************/
    let currentColor = chroma("#3498db");
    let currentNoAlpha = currentColor.alpha(1);
    let updatingUI = false;
    let undoStack = [];
    let redoStack = [];
    let savedPalettes = [];
    let historyLimit = 100;
    let isDarkMode = false;
    let currentAlpha = 1;

    /***********************
     * Theme Toggle
     ***********************/
    document.getElementById("themeToggle").addEventListener("click", () => {
        document.body.classList.toggle("light-mode");
        isDarkMode = !document.body.classList.contains("light-mode");
        const icon = isDarkMode
            ? '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2"></path><path d="M12 21v2"></path><path d="M4.22 4.22l1.42 1.42"></path><path d="M18.36 18.36l1.42 1.42"></path><path d="M1 12h2"></path><path d="M21 12h2"></path><path d="M4.22 19.78l1.42-1.42"></path><path d="M18.36 5.64l1.42-1.42"></path></svg>'
            : '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';
        document.getElementById("themeToggle").innerHTML = icon;
        updateUI();
    });

    /***********************
     * History & Saved Palettes with LocalStorage
     ***********************/
// Load saved palettes from localStorage
    function loadSavedPalettes() {
        const savedPalettesString = localStorage.getItem('colorManagerPalettes');
        if (savedPalettesString) {
            try {
                savedPalettes = JSON.parse(savedPalettesString);
                updateSavedPalettesUI();
            } catch (e) {
                console.error('Error loading saved palettes:', e);
            }
        }
    }

    // Save palettes to localStorage
    function savePalettesToLocalStorage() {
        try {
            localStorage.setItem('colorManagerPalettes', JSON.stringify(savedPalettes));
        } catch (e) {
            console.error('Error saving palettes to localStorage:', e);
        }
    }

    function updateAlphaSlider() {
        const alphaGradient = document.getElementById("alphaGradient");
        alphaGradient.style.background = `linear-gradient(to right, ${currentNoAlpha.hex()}00, ${
            currentNoAlpha.hex()})`;

        if (currentColor.luminance() > 0.2) {
            document.documentElement.style.setProperty('--accent-color', '#2e2e2e')
        } else {
            document.documentElement.style.setProperty('--accent-color', '#f4f4f4')
        }

        if (currentColor.luminance() > 0.2) {
            document.documentElement.style.setProperty('--after-color', '#2e2e2e')
        } else {
            document.documentElement.style.setProperty('--after-color', '#f4f4f4')
        }

        // Set current alpha value
        document.getElementById("alphaSlider").value = currentAlpha * 100;
        document.getElementById("alphaValue").textContent = `${Math.round(currentAlpha * 100)}%`;
    }

    document.getElementById("alphaSlider").addEventListener("input", function () {
        const alphaValue = this.value / 100;
        currentAlpha = alphaValue;
        document.getElementById("alphaValue").textContent = `${this.value}%`;

        // Update color with new alpha
        const rgbaColor = currentColor.alpha(alphaValue);
        setColor(rgbaColor.hex())
    });


    function setColor(newColor, pushHistory = true) {
        if (!newColor || !chroma.valid(newColor)) return;
        if (pushHistory) {
            undoStack.push(currentColor.hex());
            if (undoStack.length > historyLimit) {
                undoStack.shift();
            }
            redoStack = [];
            updateHistoryUI();
        }

        // Preserve alpha if the new color doesn't specify it
        const alpha = typeof newColor === 'string' && newColor.startsWith('rgba')
            ? chroma(newColor).alpha()
            : currentAlpha;

        currentColor = chroma(newColor).alpha(currentAlpha);
        currentAlpha = currentColor.alpha();
        currentNoAlpha = chroma(newColor).alpha(1);

        updateUI();
    }

    function updateHistoryUI() {
        const historyContainer = document.getElementById("historyContainer");
        historyContainer.innerHTML = "";
        undoStack.slice().reverse().forEach(colorHex => {
            const swatch = document.createElement("div");
            swatch.className = "color-swatch";
            swatch.style.backgroundColor = colorHex;
            swatch.title = colorHex;
            swatch.addEventListener("click", () => setColor(colorHex));
            historyContainer.appendChild(swatch);
        });
    }

    function updateSavedPalettesUI() {
        const container = document.getElementById("savedPalettes");
        container.innerHTML = "";
        savedPalettes.forEach((colorHex, index) => {
            const swatchContainer = document.createElement("div");
            swatchContainer.className = "color-swatch-container";
            swatchContainer.style.position = "relative";

            const swatch = document.createElement("div");
            swatch.className = "color-swatch";
            swatch.style.backgroundColor = colorHex;
            swatch.title = colorHex;
            swatch.addEventListener("click", () => setColor(colorHex));

            const removeBtn = document.createElement("button");
            removeBtn.className = "remove-swatch-btn";
            removeBtn.innerHTML = "Ã—";
            removeBtn.style.position = "absolute";
            removeBtn.style.top = "-8px";
            removeBtn.style.right = "-8px";
            removeBtn.style.backgroundColor = "var(--red)";
            removeBtn.style.color = "white";
            removeBtn.style.border = "none";
            removeBtn.style.borderRadius = "50%";
            removeBtn.style.width = "20px";
            removeBtn.style.height = "20px";
            removeBtn.style.display = "flex";
            removeBtn.style.alignItems = "center";
            removeBtn.style.justifyContent = "center";
            removeBtn.style.cursor = "pointer";
            removeBtn.style.opacity = "0";
            removeBtn.style.transition = "opacity 0.2s ease";
            removeBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                savedPalettes.splice(index, 1);
                updateSavedPalettesUI();
                savePalettesToLocalStorage();
            });

            swatchContainer.addEventListener("mouseenter", () => {
                removeBtn.style.opacity = "1";
            });

            swatchContainer.addEventListener("mouseleave", () => {
                removeBtn.style.opacity = "0";
            });

            swatchContainer.appendChild(swatch);
            swatchContainer.appendChild(removeBtn);
            container.appendChild(swatchContainer);
        });
    }

    document.querySelector(".toggle-checkbox").addEventListener('change', (e) => {
        update_toggle();
    })

    function update_toggle() {
        const c = document.querySelector('.toggle-checkbox:checked + .toggle-label');
        if (c) {
            c.style.backgroundColor = currentColor.hex();
            document.querySelector('.toggle-label').style.setProperty('--after-color', currentColor.luminance() < 0.5 ? "#fff" : "#000");
        } else {
            document.querySelector(".toggle-checkbox + .toggle-label").style.backgroundColor = 'var(--surface-tertiary)'
            document.querySelector('.toggle-label').style.setProperty('--after-color', Array.from(document.body.classList).includes('light-mode') ? "#000" : "#fff");
        }
    }

    /***********************
     * Live Preview & Contrast
     ***********************/
    function updateLivePreview() {
        const previewButton = document.getElementById("previewButton");
        const previewButtonOutline = document.getElementById("previewButtonOutline");
        const previewText = document.getElementById("previewText");
        const previewTextBold = document.getElementById("previewTextBold");
        const previewTextLighter = document.getElementById("previewTextLighter");
        const previewHeading = document.getElementById("previewHeading");
        const previewLink = document.getElementById("previewLink");
        const previewPill = document.querySelector(".preview-pill");
        const previewBadge = document.querySelector(".preview-badge");
        const previewProgressBar = document.getElementById("previewProgressBar");
        const previewCardHeader = document.getElementById("previewCardHeader");

        const textColor = currentColor.luminance() < 0.5 ? "#fff" : "#000";

        // Button styles
        previewButton.style.backgroundColor = currentColor.hex();
        previewButton.style.color = textColor;

        previewButtonOutline.style.borderColor = currentColor.hex();
        previewButtonOutline.style.color = currentColor.hex();

        // Text styles
        previewText.style.color = currentColor.hex();
        previewTextBold.style.color = currentColor.hex();
        previewTextLighter.style.color = currentColor.hex();
        previewHeading.style.color = currentColor.hex();

        const rangeInputs = document.querySelectorAll("input[type='checkbox']");
        rangeInputs.forEach(input => {
            input.style.accentColor = currentColor.hex();
            ;
        });

        const radioInputs = document.querySelectorAll("input[type='radio']");
        radioInputs.forEach(input => {
            input.style.accentColor = currentColor.hex();
            ;
        });

        // Link style
        previewLink.style.color = currentColor.hex();

        // Pill and badge
        previewPill.style.backgroundColor = currentColor.alpha(0.15).css();
        previewPill.style.color = currentColor.hex();
        previewBadge.style.backgroundColor = currentColor.hex();
        previewBadge.style.color = textColor;

        // Toggle and progress
        const checkbox = document.querySelector(".toggle-checkbox:checked + .toggle-label")
        if (checkbox) {
            checkbox.style.backgroundColor = currentColor.hex();
        }
        previewProgressBar.style.backgroundColor = currentColor.hex();

        // Card header
        previewCardHeader.style.backgroundColor = currentColor.hex();
        previewCardHeader.style.color = textColor;

        // Contrast calculation
        const contrastWithWhite = chroma.contrast(currentColor, "white").toFixed(2);
        const contrastWithBlack = chroma.contrast(currentColor, "black").toFixed(2);
        const contrastCheck = document.getElementById("contrastCheck");
        contrastCheck.innerHTML = `
			<div class="contrast-tag">
				<div class="contrast-dot" style="background-color: white;"></div>
				<span>Contrast with white: ${contrastWithWhite}</span>
			</div>
			<div class="contrast-tag">
				<div class="contrast-dot" style="background-color: black;"></div>
				<span>Contrast with black: ${contrastWithBlack}</span>
			</div>
		`;
        update_toggle();
    }

    /***********************
     * 1D Gradient (7 swatches)
     ***********************/
    function updateGradientDisplay() {
        const sliderVal = document.getElementById("gradientSlider").value;
        const intensity = sliderVal / 250;
        const baseHSL = currentColor.hsl();
        const clampL = (l) => Math.max(0, Math.min(1, l));
        let steps = [-3, -2, -1, 0, 1, 2, 3];
        let colors = steps.map(step =>
            chroma.hsl(baseHSL[0], baseHSL[1], clampL(baseHSL[2] + (step / 3) * intensity))
        );
        const gradContainer = document.getElementById("gradientDisplay");
        gradContainer.innerHTML = "";
        colors.forEach(col => {
            const swatch = document.createElement("div");
            swatch.className = "gradient-swatch";
            swatch.style.backgroundColor = col.hex();
            swatch.title = col.hex();
            swatch.addEventListener("click", () => setColor(col));
            gradContainer.appendChild(swatch);
        });
    }

    /***********************
     * 2D Gradient Grid
     ***********************/
    function updateGridDisplay() {
        const gridContainer = document.getElementById("gridDisplay");
        gridContainer.innerHTML = "";
        const gridSize = 5;
        const center = Math.floor(gridSize / 2);
        const baseHSL = currentColor.hsl();
        const baseHue = baseHSL[0], baseSat = baseHSL[1], baseLight = baseHSL[2];
        let satVar = document.getElementById("gridSatSlider").value / 100 * 0.5;
        let lightVar = document.getElementById("gridLightSlider").value / 100 * 0.5;

        for (let row = 0; row < gridSize; row++) {
            for (let col = 0; col < gridSize; col++) {
                let offsetX = col - center;
                let offsetY = row - center;
                let newSat = Math.min(1, Math.max(0, baseSat + offsetX * satVar));
                let newLight = Math.min(1, Math.max(0, baseLight + offsetY * lightVar));
                let newColor = chroma.hsl(baseHue, newSat, newLight);
                let cell = document.createElement("div");
                cell.className = "grid-cell";
                cell.style.backgroundColor = newColor.hex();
                cell.title = newColor.hex();
                cell.addEventListener("click", () => setColor(newColor));
                gridContainer.appendChild(cell);
            }
        }
    }

    /***********************
     * Color Harmonies & Vibe Adjustments
     ***********************/
    function updateHarmonies() {
        const vibe = document.getElementById("vibeSelect").value;
        ["similarColors", "complementaryColors", "analogousColors", "triadicColors", "tetradicColors", "splitColors", "luminanceConstrast"].forEach(id => {
            document.getElementById(id).innerHTML = "";
        });
        const baseHSL = currentColor.hsl();
        const similarOffsets = [-30, -20, -10, 10, 20, 30];
        similarOffsets.forEach(off => {
            let col = chroma.hsl((baseHSL[0] + off + 360) % 360, baseHSL[1], baseHSL[2]);
            col = adjustForVibe(col, vibe);
            addSwatch(col, document.getElementById("similarColors"));
        });
        let comp = getComplement(currentColor);
        comp = adjustForVibe(comp, vibe);
        addSwatch(comp, document.getElementById("complementaryColors"));
        let compPlus = chroma.hsl((comp.hsl()[0] + 10) % 360, comp.hsl()[1], comp.hsl()[2]);
        let compMinus = chroma.hsl((comp.hsl()[0] - 10 + 360) % 360, comp.hsl()[1], comp.hsl()[2]);
        compPlus = adjustForVibe(compPlus, vibe);
        compMinus = adjustForVibe(compMinus, vibe);
        addSwatch(compPlus, document.getElementById("complementaryColors"));
        addSwatch(compMinus, document.getElementById("complementaryColors"));
        let ana1 = chroma.hsl((baseHSL[0] + 30) % 360, baseHSL[1], baseHSL[2]);
        let ana2 = chroma.hsl((baseHSL[0] - 30 + 360) % 360, baseHSL[1], baseHSL[2]);
        ana1 = adjustForVibe(ana1, vibe);
        ana2 = adjustForVibe(ana2, vibe);
        addSwatch(ana1, document.getElementById("analogousColors"));
        addSwatch(ana2, document.getElementById("analogousColors"));
        let tri1 = chroma.hsl((baseHSL[0] + 120) % 360, baseHSL[1], baseHSL[2]);
        let tri2 = chroma.hsl((baseHSL[0] + 240) % 360, baseHSL[1], baseHSL[2]);
        tri1 = adjustForVibe(tri1, vibe);
        tri2 = adjustForVibe(tri2, vibe);
        addSwatch(tri1, document.getElementById("triadicColors"));
        addSwatch(tri2, document.getElementById("triadicColors"));
        let tet1 = chroma.hsl((baseHSL[0] + 90) % 360, baseHSL[1], baseHSL[2]);
        let tet2 = chroma.hsl((baseHSL[0] + 180) % 360, baseHSL[1], baseHSL[2]);
        let tet3 = chroma.hsl((baseHSL[0] + 270) % 360, baseHSL[1], baseHSL[2]);
        tet1 = adjustForVibe(tet1, vibe);
        tet2 = adjustForVibe(tet2, vibe);
        tet3 = adjustForVibe(tet3, vibe);
        addSwatch(tet1, document.getElementById("tetradicColors"));
        addSwatch(tet2, document.getElementById("tetradicColors"));
        addSwatch(tet3, document.getElementById("tetradicColors"));
        let split1 = chroma.hsl((baseHSL[0] + 180 - 30 + 360) % 360, baseHSL[1], baseHSL[2]);
        let split2 = chroma.hsl((baseHSL[0] + 180 + 30) % 360, baseHSL[1], baseHSL[2]);
        split1 = adjustForVibe(split1, vibe);
        split2 = adjustForVibe(split2, vibe);
        addSwatch(split1, document.getElementById("splitColors"));
        addSwatch(split2, document.getElementById("splitColors"));
        let contrast = currentColor.luminance() > 0.5 ? chroma("black") : chroma("white");
        addSwatch(contrast, document.getElementById("luminanceConstrast"));
    }

    function addSwatch(color, container) {
        const swatch = document.createElement("div");
        swatch.className = "color-swatch";
        swatch.style.backgroundColor = color.hex();
        swatch.title = color.hex();
        swatch.addEventListener("click", () => setColor(color));
        container.appendChild(swatch);
    }

    function getComplement(color) {
        let hsl = color.hsl();
        hsl[0] = (hsl[0] + 180) % 360;
        return chroma.hsl(hsl[0], hsl[1], hsl[2]);
    }

    function adjustForVibe(color, vibe) {
        let hsl = color.hsl();
        switch (vibe) {
            case "pastel":
                return chroma.hsl(hsl[0], hsl[1] * 0.5, Math.min(hsl[2] + 0.15, 1));
            case "retro":
                return chroma.hsl(hsl[0], hsl[1] * 0.8, hsl[2] * 0.9);
            case "cyberpunk":
                return chroma.hsl(hsl[0], Math.min(hsl[1] * 1.3, 1), Math.min(hsl[2] + 0.1, 1));
            case "vintage":
                return chroma.hsl((hsl[0] + 10) % 360, hsl[1] * 0.7, hsl[2]);
            case "vibrant":
                return chroma.hsl(hsl[0], Math.min(hsl[1] * 1.5, 1), hsl[2]);
            case "professional":
                return chroma.hsl(hsl[0], hsl[1] * 0.85, hsl[2]);
            case "earthy":
                return chroma.hsl((hsl[0] - 20 + 360) % 360, Math.max(hsl[1] - 0.2, 0), hsl[2]);
            case "neon":
                return chroma.hsl(hsl[0], 1, Math.min(hsl[2] + 0.2, 1));
            case "monochrome":
                return chroma.hsl(hsl[0], 0, hsl[2]);
            case "warm":
                return chroma.hsl((hsl[0] + 10) % 360, hsl[1], hsl[2]);
            case "cool":
                return chroma.hsl((hsl[0] - 10 + 360) % 360, hsl[1], hsl[2]);
            default:
                return color;
        }
    }

    /***********************
     * CMYK Conversions
     ***********************/
    function rgbToCmyk(r, g, b) {
        let rP = r / 255, gP = g / 255, bP = b / 255;
        let k = 1 - Math.max(rP, gP, bP);
        let c = (1 - rP - k) / (1 - k) || 0;
        let m = (1 - gP - k) / (1 - k) || 0;
        let y = (1 - bP - k) / (1 - k) || 0;
        return [c, m, y, k];
    }

    function cmykToRgb(c, m, y, k) {
        let r = 255 * (1 - c) * (1 - k);
        let g = 255 * (1 - m) * (1 - k);
        let b = 255 * (1 - y) * (1 - k);
        return [r, g, b];
    }

    /***********************
     * CSS Filter Generator functions - IMPROVED!
     ***********************/
// Function to manually apply CSS filter based on slider values
    function updateManualCssFilter() {
        const invert = document.getElementById("filterInvert").value;
        const sepia = document.getElementById("filterSepia").value;
        const saturate = document.getElementById("filterSaturate").value;
        const hueRotate = document.getElementById("filterHue").value;
        const brightness = document.getElementById("filterBrightness").value;
        const contrast = document.getElementById("filterContrast").value;

        const filterStr = `invert(${invert}%) sepia(${sepia}%) saturate(${saturate}%) hue-rotate(${hueRotate}deg) brightness(${brightness}%) contrast(${contrast}%)`;

        document.getElementById("computedFilter").innerText = filterStr;
        document.getElementById("cssTargetColor").innerText = currentColor.hex();
        document.getElementById("filterInput").value = filterStr;

        // Apply filter to SVG icons
        Array.from(document.querySelectorAll("#icon-container>svg")).forEach((e) => e.style.filter = filterStr);
    }

    function applyFilterToBlack(params) {
        // Start with black [0,0,0]. Then simulate the filter chain.
        let inv = params.invert / 100;
        // invert: mix black and white (if invert is 100, result is white)
        let r = (1 - inv) * 0 + inv * 255;
        let g = (1 - inv) * 0 + inv * 255;
        let b = (1 - inv) * 0 + inv * 255;
        // sepia: apply a simple sepia transformation
        let s = params.sepia / 100;
        let rSep = r * (1 - s) + (r * 0.393 + g * 0.769 + b * 0.189) * s;
        let gSep = g * (1 - s) + (r * 0.349 + g * 0.686 + b * 0.168) * s;
        let bSep = b * (1 - s) + (r * 0.272 + g * 0.534 + b * 0.131) * s;
        r = rSep;
        g = gSep;
        b = bSep;
        // saturate: adjust saturation via HSL
        let col = chroma([r, g, b]);
        let hsl = col.hsl();
        let satFactor = params.saturate / 100; // 100 means no change
        hsl[1] = hsl[1] * satFactor;
        col = chroma.hsl(hsl[0], hsl[1], hsl[2]);
        [r, g, b] = col.rgb();
        // hue-rotate: add hue rotation (in degrees)
        col = chroma([r, g, b]);
        hsl = col.hsl();
        hsl[0] = (hsl[0] + params.hueRotate) % 360;
        col = chroma.hsl(hsl[0], hsl[1], hsl[2]);
        [r, g, b] = col.rgb();
        // brightness: multiply each channel
        let bright = params.brightness / 100;
        r *= bright;
        g *= bright;
        b *= bright;
        // contrast: adjust contrast using a simple formula
        let contrast = params.contrast / 100;
        r = 128 + contrast * (r - 128);
        g = 128 + contrast * (g - 128);
        b = 128 + contrast * (b - 128);
        // Clamp channels to [0,255]
        r = Math.max(0, Math.min(255, r));
        g = Math.max(0, Math.min(255, g));
        b = Math.max(0, Math.min(255, b));
        return [r, g, b];
    }

    function solveCssFilter(targetHex) {
        let targetColor = chroma(targetHex);
        let best = {
            params: {invert: 0, sepia: 0, saturate: 100, hueRotate: 0, brightness: 100, contrast: 100},
            loss: Infinity
        };
        // Random search initial phase
        for (let i = 0; i < 1000; i++) {
            let candidate = {
                invert: Math.random() * 100,
                sepia: Math.random() * 100,
                saturate: 100 + Math.random() * 500,
                hueRotate: Math.random() * 360,
                brightness: 50 + Math.random() * 150,
                contrast: 50 + Math.random() * 150
            };
            let result = applyFilterToBlack(candidate);
            let candidateColor = chroma.rgb(result);
            let loss = chroma.deltaE(candidateColor, targetColor);
            if (loss < best.loss) {
                best = {params: candidate, loss: loss};
            }
        }
        // Local refinement phase
        for (let i = 0; i < 1000; i++) {
            let candidate = {
                invert: best.params.invert + (Math.random() - 0.5) * 10,
                sepia: best.params.sepia + (Math.random() - 0.5) * 10,
                saturate: best.params.saturate + (Math.random() - 0.5) * 50,
                hueRotate: best.params.hueRotate + (Math.random() - 0.5) * 20,
                brightness: best.params.brightness + (Math.random() - 0.5) * 20,
                contrast: best.params.contrast + (Math.random() - 0.5) * 20
            };
            candidate.invert = Math.max(0, Math.min(100, candidate.invert));
            candidate.sepia = Math.max(0, Math.min(100, candidate.sepia));
            candidate.saturate = Math.max(0, candidate.saturate);
            candidate.hueRotate = ((candidate.hueRotate % 360) + 360) % 360;
            candidate.brightness = Math.max(0, candidate.brightness);
            candidate.contrast = Math.max(0, candidate.contrast);
            let result = applyFilterToBlack(candidate);
            let candidateColor = chroma.rgb(result);
            let loss = chroma.deltaE(candidateColor, targetColor);
            if (loss < best.loss) {
                best = {params: candidate, loss: loss};
            }
        }

        // Update UI sliders with computed values
        document.getElementById("filterInvert").value = Math.round(best.params.invert);
        document.getElementById("filterSepia").value = Math.round(best.params.sepia);
        document.getElementById("filterSaturate").value = Math.round(best.params.saturate);
        document.getElementById("filterHue").value = Math.round(best.params.hueRotate);
        document.getElementById("filterBrightness").value = Math.round(best.params.brightness);
        document.getElementById("filterContrast").value = Math.round(best.params.contrast);

        return best;
    }

    function cssFilterString(params) {
        return `invert(${params.invert.toFixed(0)}%) sepia(${params.sepia.toFixed(0)}%) saturate(${params.saturate.toFixed(0)}%) hue-rotate(${params.hueRotate.toFixed(0)}deg) brightness(${params.brightness.toFixed(0)}%) contrast(${params.contrast.toFixed(0)}%)`;
    }

    function updateCssFilter() {
        let result = solveCssFilter(currentColor.hex());
        let filterStr = cssFilterString(result.params);
        document.getElementById("computedFilter").innerText = filterStr;
        document.getElementById("cssTargetColor").innerText = currentColor.hex();
        document.getElementById("filterLoss").innerText = "Loss: " + result.loss.toFixed(2);

        // String to evaluate loss
        let lossStr;
        if (result.loss < 1) {
            lossStr = "Probably good.";
        } else if (result.loss < 5) {
            lossStr = "Meh.";
        } else if (result.loss < 15) {
            lossStr = "Not great. Likely want to re-run.";
        } else {
            lossStr = "Yikes. Extremely off, please recompute."
        }

        document.getElementById("lossString").innerText = lossStr;

        // Update Filter for Svgs
        Array.from(document.querySelectorAll("#icon-container>svg")).forEach((e) => e.style.filter = filterStr);

        // Link computed filter value to the CSS Filter input box
        document.getElementById("filterInput").value = filterStr;
    }

    function colorToFilter(color) {
        let lum = color.luminance();
        let inv = ((1 - lum) * 100).toFixed(0);
        return `invert(${inv}%) hue-rotate(0deg)`;
    }

    function filterToColor(filterStr) {
        const invMatch = filterStr.match(/invert\(\s*(\d+)%\s*\)/);
        const hueMatch = filterStr.match(/hue-rotate\(\s*(\d+)deg\s*\)/);
        let invFactor = invMatch ? parseInt(invMatch[1], 10) / 100 : 0;
        let hueAdj = hueMatch ? parseInt(hueMatch[1], 10) : 0;
        let comp = getComplement(currentColor);
        let newColor = chroma.mix(currentColor, comp, invFactor, 'rgb');
        let hsl = newColor.hsl();
        hsl[0] = (hsl[0] + hueAdj) % 360;
        return chroma.hsl(hsl[0], hsl[1], hsl[2]);
    }

    /***********************
     * Shadow Generator
     ***********************/
    function updateShadowPreview() {
        const shadowType = document.querySelector('.shadow-option[data-type].active').getAttribute('data-type');
        const colorType = document.querySelector('.shadow-option[data-color-type].active').getAttribute('data-color-type');

        const xOffset = document.getElementById('shadowX').value;
        const yOffset = document.getElementById('shadowY').value;
        const blurRadius = document.getElementById('shadowBlur').value;
        const spreadRadius = document.getElementById('shadowSpread').value;
        const opacity = document.getElementById('shadowOpacity').value / 100;

        const colorHex = currentColor.hex();
        const shadowBox = document.getElementById('shadowBox');

        // Get custom shadow color
        const shadowColorHex = document.getElementById('shadowColorInput').value;
        const shadowColor = chroma(shadowColorHex).alpha(opacity).css();

        // Determine box and shadow color based on options
        if (colorType === 'color-box') {
            // COLOR Box + Shadow
            shadowBox.style.backgroundColor = colorHex;
            shadowBox.style.color = currentColor.luminance() > 0.5 ? "#000" : "#fff";
        } else {
            // Black/White Box + COLOR Shadow - FIXED: Use shadow color for the box
            shadowBox.style.backgroundColor = shadowColorHex;
            shadowBox.style.color = chroma(shadowColorHex).luminance() > 0.5 ? "#000" : "#fff";
        }

        // Clear previous shadow
        shadowBox.style.boxShadow = '';

        // Create shadow string
        const shadowColorToUse = colorType === 'color-box' ? shadowColor : currentColor.alpha(opacity).css();
        const shadowString = `${xOffset}px ${yOffset}px ${blurRadius}px ${spreadRadius}px ${shadowColorToUse}`;

        // Apply shadow based on type
        if (shadowType === 'outside') {
            shadowBox.style.boxShadow = shadowString;
        } else {
            shadowBox.style.boxShadow = `inset ${shadowString}`;
        }

        // Update CSS output
        const cssPrefix = shadowType === 'outside' ? 'box-shadow: ' : 'box-shadow: inset ';
        document.getElementById('shadowCssOutput').value = cssPrefix + shadowString + ';';
    }

    /***********************
     * Color Mixer
     ***********************/
    function updateColorMixer() {
        const color1 = chroma(document.getElementById('mixColor1').value);
        const color2 = chroma(document.getElementById('mixColor2').value);
        const useColor3 = document.getElementById('useColor3').checked;
        const color3 = useColor3 ? chroma(document.getElementById('mixColor3').value) : null;
        const mixRatio = document.getElementById('mixRatio').value / 100;
        const preview = document.getElementById('gradientMixPreview');

        let mixedColor;
        if (useColor3) {
            // Mix all three colors
            const mix12 = chroma.mix(color1, color2, mixRatio);
            mixedColor = chroma.mix(mix12, color3, mixRatio);
        } else {
            // Mix just two colors
            mixedColor = chroma.mix(color1, color2, mixRatio);
        }

        preview.style.background = mixedColor.hex();
        const cssOutput = `background-color: ${mixedColor.hex()};`;
        document.getElementById('gradientCssOutput').value = cssOutput;

        // Store the mixed color for the "Use Mix Result" button
        preview.dataset.mixedColor = mixedColor.hex();
    }

    /***********************
     * Gradient Generator
     ***********************/
    function updateGradientGenerator() {
        const color1 = chroma(document.getElementById('gradColor1').value);
        const color2 = chroma(document.getElementById('gradColor2').value);
        const useColor3 = document.getElementById('useGradColor3').checked;
        const color3 = useColor3 ? chroma(document.getElementById('gradColor3').value) : null;
        const gradientType = document.querySelector('.shadow-option[data-gradient-type].active').getAttribute('data-gradient-type');
        const angle = document.getElementById('gradientAngle').value;
        const preview = document.getElementById('gradientPreview');

        let gradient;
        let cssOutput;

        if (gradientType === 'linear') {
            if (useColor3) {
                gradient = `linear-gradient(${angle}deg, ${color1.hex()}, ${color2.hex()}, ${color3.hex()})`;
            } else {
                gradient = `linear-gradient(${angle}deg, ${color1.hex()}, ${color2.hex()})`;
            }
        } else { // radial
            if (useColor3) {
                gradient = `radial-gradient(circle, ${color1.hex()}, ${color2.hex()}, ${color3.hex()})`;
            } else {
                gradient = `radial-gradient(circle, ${color1.hex()}, ${color2.hex()})`;
            }
        }

        preview.style.background = gradient;
        cssOutput = `background: ${gradient};`;
        document.getElementById('gradientOutput').value = cssOutput;

        // Store the gradient for the "Use Gradient" button
        preview.dataset.gradient = gradient;
    }

    /***********************
     * Mode Color Suggestions
     ***********************/
    function updateModeColorSuggestions() {
        const colorHSL = currentColor.hsl();
        const isCurrentColorDark = currentColor.luminance() < 0.4;
        let lightVersion, darkVersion;

        if (isCurrentColorDark) {
            // For dark colors, create a lighter version
            lightVersion = chroma.hsl(
                colorHSL[0],
                Math.max(0, colorHSL[1] - 0.1), // Slightly reduce saturation
                Math.min(0.85, colorHSL[2] + 0.4) // Boost lightness
            );

            // Keep dark version similar but adjust for better contrast
            darkVersion = chroma.hsl(
                colorHSL[0],
                Math.min(1, colorHSL[1] + 0.05), // Slightly increase saturation
                Math.max(0.1, colorHSL[2] - 0.05) // Make slightly darker
            );
        } else {
            // For light colors, create a darker version
            darkVersion = chroma.hsl(
                colorHSL[0],
                Math.min(1, colorHSL[1] + 0.1), // Increase saturation
                Math.max(0.15, colorHSL[2] - 0.4) // Reduce lightness
            );

            // Keep light version similar but adjust for better contrast
            lightVersion = chroma.hsl(
                colorHSL[0],
                Math.max(0, colorHSL[1] - 0.05), // Slightly reduce saturation
                Math.min(0.95, colorHSL[2] + 0.05) // Make slightly lighter
            );
        }

        // Update the preview colors
        document.getElementById('lightModePreview').style.backgroundColor = lightVersion.hex();
        document.getElementById('lightModePreview').style.color = lightVersion.luminance() > 0.5 ? '#000' : '#fff';
        document.getElementById('lightModeHex').innerText = lightVersion.hex();

        document.getElementById('darkModePreview').style.backgroundColor = darkVersion.hex();
        document.getElementById('darkModePreview').style.color = darkVersion.luminance() > 0.5 ? '#000' : '#fff';
        document.getElementById('darkModeHex').innerText = darkVersion.hex();

        // Make the halves clickable to apply the color
        document.getElementById('lightModePreview').addEventListener('click', () => {
            setColor(lightVersion.hex());
        });

        document.getElementById('darkModePreview').addEventListener('click', () => {
            setColor(darkVersion.hex());
        });
    }

    /***********************
     * Parsing & Validation for Inputs
     ***********************/
    function parseHex(val) {
        if (!/^#([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$/.test(val.trim()))
            return parseQuickHex(val);
        return chroma(val.trim());
    }

    function parseQuickHex(val) {
        if (!/([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$/.test(val.trim()))
            throw new Error("Invalid hex format");
        return chroma("#" + val.trim());
    }

    function parseRGBA(val) {
        let m = val.match(/rgba?\s*\(\s*(\d+)[,\s]+(\d+)[,\s]+(\d+)(?:[,\s]+([\d.]+))?\s*\)/);
        if (!m) throw new Error("Invalid RGBA format");
        let r = parseInt(m[1], 10),
            g = parseInt(m[2], 10),
            b = parseInt(m[3], 10),
            a = m[4] !== undefined ? parseFloat(m[4]) : 1;
        return chroma(r, g, b, a);
    }

    function parseHSL(val) {
        let m = val.match(/hsl\s*\(\s*(\d+)[,\s]+(\d+)%[,\s]+(\d+)%\s*\)/);
        if (!m) throw new Error("Invalid HSL format");
        let h = parseInt(m[1], 10),
            s = parseInt(m[2], 10) / 100,
            l = parseInt(m[3], 10) / 100;
        return chroma.hsl(h, s, l);
    }

    function parseLab(val) {
        let m = val.match(/lab\s*\(\s*([\d.]+)[,\s]+([-]?[\d.]+)[,\s]+([-]?[\d.]+)\s*\)/);
        if (!m) throw new Error("Invalid Lab format");
        let L = parseFloat(m[1]),
            a = parseFloat(m[2]),
            b = parseFloat(m[3]);
        return chroma.lab(L, a, b);
    }

    function parseLCH(val) {
        let m = val.match(/lch\s*\(\s*([\d.]+)[,\s]+([\d.]+)[,\s]+([\d.]+)\s*\)/);
        if (!m) throw new Error("Invalid LCH format");
        let L = parseFloat(m[1]),
            C = parseFloat(m[2]),
            h = parseFloat(m[3]);
        return chroma.lch(L, C, h);
    }

    function parseCMYK(val) {
        let m = val.match(/cmyk\s*\(\s*([\d.]+)%?\s*,\s*([\d.]+)%?\s*,\s*([\d.]+)%?\s*,\s*([\d.]+)%?\s*\)/);
        if (!m) throw new Error("Invalid CMYK format");
        let c = parseFloat(m[1]),
            mC = parseFloat(m[2]),
            y = parseFloat(m[3]),
            k = parseFloat(m[4]);
        if (c > 1 || mC > 1 || y > 1 || k > 1) {
            c /= 100;
            mC /= 100;
            y /= 100;
            k /= 100;
        }
        let rgbArr = cmykToRgb(c, mC, y, k);
        return chroma(rgbArr);
    }

    function parseFilter(val) {
        return filterToColor(val);
    }

    function debounce(func, wait) {
        let timeout;
        return function (...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }

    /***********************
     * Border Generator
     ***********************/
    document.querySelectorAll('.shadow-option[data-border-type]').forEach(option => {
        option.addEventListener('click', function () {
            document.querySelectorAll('.shadow-option[data-border-type]').forEach(el => el.classList.remove('active'));
            this.classList.add('active');
            updateBorderPreview();
        });
    });

    ['borderWidth', 'borderRadius', 'borderOpacity', 'borderLightness', 'borderColorInput', 'borderStyle'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateBorderPreview);
    });

    function updateBorderPreview() {
        const borderType = document.querySelector('.shadow-option[data-border-type].active').getAttribute('data-border-type');

        const borderWidth = document.getElementById('borderWidth').value;
        const borderRadius = document.getElementById('borderRadius').value;
        const borderOpacity = document.getElementById('borderOpacity').value / 100;
        const borderLightness = document.getElementById('borderLightness').value;
        const borderStyle = document.getElementById('borderStyle').value;

        const mainColor = currentColor.hex();
        const borderBox = document.getElementById('borderBox');

        // Get border color and adjust lightness if needed
        let borderColorBase = document.getElementById('borderColorInput').value;
        let borderColor = chroma(borderColorBase);

        if (borderLightness !== 0) {
            // Adjust lightness
            const lch = borderColor.lch();
            let newL = lch[0] + parseFloat(borderLightness);
            newL = Math.max(0, Math.min(100, newL)); // Clamp between 0-100
            borderColor = chroma.lch(newL, lch[1], lch[2]);
        }

        // Apply opacity
        borderColor = borderColor.alpha(borderOpacity);

        // Determine box and border color based on options
        if (borderType === 'color-border') {
            // COLOR Border + Box
            borderBox.style.backgroundColor = mainColor;
            borderBox.style.color = currentColor.luminance() > 0.5 ? "#000" : "#fff";
            borderBox.style.border = `${borderWidth}px ${borderStyle} ${borderColor.css()}`;
        } else {
            // COLOR Box + Border
            borderBox.style.backgroundColor = mainColor;
            borderBox.style.color = currentColor.luminance() > 0.5 ? "#000" : "#fff";
            borderBox.style.border = `${borderWidth}px ${borderStyle} ${borderColor.css()}`;
        }

        // Apply border radius
        borderBox.style.borderRadius = `${borderRadius}px`;

        // Update CSS output
        const cssOutput = `
	border: ${borderWidth}px ${borderStyle} ${borderColor.css()};
	border-radius: ${borderRadius}px;
	${borderType === 'color-box' ? `background-color: ${mainColor};` : ''}
	`.trim();

        document.getElementById('borderCssOutput').value = cssOutput;
    }

    /***********************
     * Event Listeners
     ***********************/
    document.getElementById("hexInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseHex(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("hexError").innerText = err.message;
        }
    }, 500));

    document.getElementById("rgbaInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseRGBA(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("rgbaError").innerText = err.message;
        }
    }, 500));

    document.getElementById("hslInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseHSL(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("hslError").innerText = err.message;
        }
    }, 500));

    document.getElementById("labInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseLab(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("labError").innerText = err.message;
        }
    }, 500));

    document.getElementById("lchInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseLCH(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("lchError").innerText = err.message;
        }
    }, 500));

    document.getElementById("cmykInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseCMYK(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("cmykError").innerText = err.message;
        }
    }, 500));

    document.getElementById("filterInput").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        try {
            let col = parseFilter(e.target.value);
            setColor(col);
        } catch (err) {
            e.target.classList.add("error");
            document.getElementById("filterError").innerText = err.message;
        }
    }, 500));

    document.getElementById("colorPicker").addEventListener("input", debounce((e) => {
        if (updatingUI) return;
        // When changing color with the picker, preserve the current alpha
        const newColor = chroma(e.target.value).alpha(currentAlpha);
        setColor(newColor);
    }, 300));

    document.getElementById("eyeDropperBtn").addEventListener("click", async () => {
        if (window.EyeDropper) {
            try {
                const eye = new EyeDropper();
                const result = await eye.open();
                setColor(result.sRGBHex);
            } catch (err) {
                console.error("EyeDropper error:", err);
            }
        } else {
            console.error('EyeDropper API not supported in this browser');
        }
    });

    document.getElementById("randomColorBtn").addEventListener("click", () => {
        let rand = chroma.random();
        setColor(rand);
    });

    document.getElementById("gradientSlider").addEventListener("input", updateGradientDisplay);
    document.getElementById("vibeSelect").addEventListener("change", updateHarmonies);
    document.getElementById("gridSatSlider").addEventListener("input", updateGridDisplay);
    document.getElementById("gridLightSlider").addEventListener("input", updateGridDisplay);

    // CSS Filter sliders
    ["filterInvert", "filterSepia", "filterSaturate", "filterHue", "filterBrightness", "filterContrast"].forEach(id => {
        document.getElementById(id).addEventListener("input", updateManualCssFilter);
    });
    document.getElementById("recomputeFilterBtn").addEventListener("click", updateCssFilter);

    // Shadow generator controls
    document.querySelectorAll('.shadow-option[data-type]').forEach(option => {
        option.addEventListener('click', function () {
            document.querySelectorAll('.shadow-option[data-type]').forEach(el => el.classList.remove('active'));
            this.classList.add('active');
            updateShadowPreview();
        });
    });

    document.querySelectorAll('.shadow-option[data-color-type]').forEach(option => {
        option.addEventListener('click', function () {
            document.querySelectorAll('.shadow-option[data-color-type]').forEach(el => el.classList.remove('active'));
            this.classList.add('active');
            updateShadowPreview();
        });
    });

    ['shadowX', 'shadowY', 'shadowBlur', 'shadowSpread', 'shadowOpacity', 'shadowColorInput'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateShadowPreview);
    });

    // Color mixer controls
    ['mixColor1', 'mixColor2', 'mixColor3', 'mixRatio'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateColorMixer);
    });

    document.getElementById('useColor3').addEventListener('change', updateColorMixer);

    document.getElementById('gradientMixPreview').addEventListener('click', function () {
        const mixedColor = document.getElementById('gradientMixPreview').dataset.mixedColor;
        if (mixedColor) {
            setColor(mixedColor);
        }
    });

    // Gradient generator controls
    document.querySelectorAll('.shadow-option[data-gradient-type]').forEach(option => {
        option.addEventListener('click', function () {
            document.querySelectorAll('.shadow-option[data-gradient-type]').forEach(el => el.classList.remove('active'));
            this.classList.add('active');
            updateGradientGenerator();
        });
    });

    ['gradColor1', 'gradColor2', 'gradColor3', 'gradientAngle'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateGradientGenerator);
    });

    document.getElementById('useGradColor3').addEventListener('change', updateGradientGenerator);

    function undo() {
        if (undoStack.length > 0) {
            redoStack.push(currentColor.hex());
            let prevColor = undoStack.pop();
            setColor(prevColor, false);
            updateHistoryUI();
        }
    }

    function redo() {
        if (redoStack.length > 0) {
            undoStack.push(currentColor.hex());
            if (undoStack.length > historyLimit) {
                undoStack.shift();
            }
            let nextColor = redoStack.pop();
            setColor(nextColor, false);
            updateHistoryUI();
        }
    }

    document.getElementById("undoBtn").addEventListener("click", () => {
        undo();
    });
    document.getElementById("redoBtn").addEventListener("click", () => {
        redo();
    });

    document.getElementById("savePaletteBtn").addEventListener("click", () => {
        savedPalettes.push(currentColor.hex());
        updateSavedPalettesUI();
        savePalettesToLocalStorage();
    });

    document.getElementById("clearPaletteBtn").addEventListener("click", () => {
        savedPalettes = [];
        updateSavedPalettesUI();
        savePalettesToLocalStorage();
    });

    function changeBackgroundColor() {
        document.body.style.backgroundColor = currentColor.hex();
    }

    function resetBackgroundColor() {
        document.body.style.backgroundColor = "";
        document.body.style.color = "";
        document.body.classList.toggle("light-mode", !isDarkMode);
    }

    document.getElementById("changeBackground").addEventListener("click", () => {
        changeBackgroundColor();
    });
    document.getElementById("resetBackground").addEventListener("click", () => {
        resetBackgroundColor();
    });

    document.addEventListener('keydown', (e) => {
        if (e.shiftKey && e.code == 'KeyL') {
            document.body.style.filter = "invert(1)";
        } else if (e.shiftKey && e.code == 'KeyI') {
            document.body.style.filter = document.body.style.filter === "invert(1)" ? "" : "invert(1)";
        } else if (e.shiftKey && e.code == 'KeyB') {
            changeBackgroundColor();
        } else if (e.shiftKey && e.code == 'KeyW') {
            resetBackgroundColor();
        } else if (e.ctrlKey && e.code == 'KeyZ') {
            undo();
        } else if (e.ctrlKey && e.code == 'KeyY') {
            redo();
        } else if (e.shiftKey && e.code == 'KeyS') {
            savedPalettes.push(currentColor.hex());
            updateSavedPalettesUI();
            savePalettesToLocalStorage();
        } else if (e.shiftKey && e.code == 'KeyC') {
            navigator.clipboard.writeText(currentColor.hex());
        }
    }, false);

    document.addEventListener('keyup', (e) => {
        if (e.shiftKey && e.code == 'KeyL') {
            document.body.style.filter = "";
        }
    }, false);

    /***********************
     * Update All UI Fields
     ***********************/
    function updateUI() {
        updatingUI = true;
        // Use hex without alpha for the color picker
        document.getElementById("colorPicker").value = currentNoAlpha.hex();

        // Use rgba with alpha for display
        document.getElementById("colorDisplay").style.backgroundColor = currentColor.css();
        document.getElementById("colorHex").innerText = currentColor.hex();

        const textColor = currentColor.luminance() < 0.5 ? "#ffffff" : "#000000";
        document.getElementById("colorHex").style.color = textColor;
        document.getElementById("hexInput").value = currentColor.alpha(currentAlpha).hex();
        document.getElementById("hexInput").classList.remove("error");
        document.getElementById("hexError").innerText = "";

        // Update rgba with proper alpha
        let rgba = currentColor.rgba();
        document.getElementById("rgbaInput").value = `rgba(${rgba[0]}, ${rgba[1]}, ${rgba[2]}, ${parseFloat(rgba[3].toFixed(2))})`;
        document.getElementById("rgbaInput").classList.remove("error");
        document.getElementById("rgbaError").innerText = "";

        // Rest of the function remains the same
        let hsl = currentColor.hsl();
        document.getElementById("hslInput").value = `hsl(${Math.round(hsl[0])}, ${Math.round(hsl[1] * 100)}%, ${Math.round(hsl[2] * 100)}%)`;
        document.getElementById("hslInput").classList.remove("error");
        document.getElementById("hslError").innerText = "";
        let lab = currentColor.lab();
        document.getElementById("labInput").value = `lab(${lab[0].toFixed(1)}, ${lab[1].toFixed(1)}, ${lab[2].toFixed(1)})`;
        document.getElementById("labInput").classList.remove("error");
        document.getElementById("labError").innerText = "";
        let lch = currentColor.lch();
        document.getElementById("lchInput").value = `lch(${lch[0].toFixed(1)}, ${lch[1].toFixed(1)}, ${lch[2].toFixed(1)})`;
        document.getElementById("lchInput").classList.remove("error");
        document.getElementById("lchError").innerText = "";
        let rgb = currentColor.rgb();
        let cmyk = rgbToCmyk(rgb[0], rgb[1], rgb[2]);
        let cmykPercent = cmyk.map(v => Math.round(v * 100));
        document.getElementById("cmykInput").value = `cmyk(${cmykPercent[0]}%, ${cmykPercent[1]}%, ${cmykPercent[2]}%, ${cmykPercent[3]}%)`;
        document.getElementById("cmykInput").classList.remove("error");
        document.getElementById("cmykError").innerText = "";
        document.getElementById("filterInput").classList.remove("error");
        document.getElementById("filterError").innerText = "";

        // Update alpha slider
        updateAlphaSlider();

        updateLivePreview();
        updateGradientDisplay();
        updateHarmonies();
        updateGridDisplay();
        updateCssFilter();
        updateShadowPreview();
        updateColorMixer();
        updateGradientGenerator();
        updateModeColorSuggestions();
        updateBorderPreview();

        // Set default input values for color mixer and gradient
        document.getElementById('mixColor1').value = currentNoAlpha.hex();
        document.getElementById('gradColor1').value = currentNoAlpha.hex();

        updatingUI = false;
    }

    /***********************
     * Copy to Clipboard for Copy Buttons
     ***********************/
    document.querySelectorAll(".copy-btn").forEach(btn => {
        btn.addEventListener("click", function () {
            const targetId = this.getAttribute("data-target");
            const targetInput = document.getElementById(targetId);
            if (targetInput) {
                navigator.clipboard.writeText(targetInput.value);
            }
        });
    });

    /***********************
     * Initial Draw and Setup
     ***********************/
// Load saved palettes from local storage on startup
    loadSavedPalettes();
    updateUI();

    // Initialize the color mixer and gradient generator
    updateColorMixer();
    updateGradientGenerator();

    // Make sure the mode preview halves are clickable
    document.getElementById('lightModePreview').style.cursor = 'pointer';
    document.getElementById('darkModePreview').style.cursor = 'pointer';

</script>
</body>
</html>