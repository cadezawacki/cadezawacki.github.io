<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Spotify Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Basic styling using monospace font and dark theme */
        body {
            font-family: monospace;
            background-color: #121212; /* Dark background */
            color: #b3b3b3; /* Light grey text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        /* Styling for buttons and button-like links */
        button, a.button-style {
            background: none;
            border: 1px solid #b3b3b3;
            color: #b3b3b3;
            padding: 5px 10px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
            text-decoration: none;
            display: inline-block;
            border-radius: 4px; /* Slightly rounded corners */
            vertical-align: middle; /* Align buttons and inputs */
            transition: all 0.2s ease; /* Smooth hover effect */
        }
        button:hover, a.button-style:hover {
            border-color: #ffffff;
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.1); /* Subtle background on hover */
        }
        button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        /* Styling for text input fields */
        input[type="text"] {
            background-color: #282828;
            border: 1px solid #535353;
            color: #ffffff;
            padding: 5px 8px;
            font-family: monospace;
            border-radius: 4px;
            margin: 5px;
            min-width: 250px; /* Give input some width */
            vertical-align: middle; /* Align with buttons */
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #b3b3b3;
        }
        /* Styling for the track info display */
        .track-info {
            margin-top: 20px;
            min-height: 40px; /* Reserve space */
            font-size: 1.1em;
        }
        /* Styling for error messages */
        .error-message {
            color: #f56565; /* Red color for errors */
            margin-top: 15px;
            min-height: 1.2em; /* Reserve space for errors */
        }
        /* Styling for informational messages */
        .info-message {
            color: #a0aec0; /* Lighter grey for info */
            font-size: 0.9em;
            margin-top: 5px;
        }
        /* Styling for sections like Client ID input */
        .input-section {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px dashed #535353;
            border-radius: 4px;
        }
        /* Styling for the access token footer */
        .token-footer {
            margin-top: 25px;
            font-size: 0.8em;
            color: #535353; /* Faded color */
            word-break: break-all; /* Allow long token to wrap */
            padding: 5px;
            border-top: 1px solid #282828; /* Subtle separator */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-xl mb-4">[ Cade's Minimal Player ]</h1>

        <div id="login-section">
            <div class="input-section client-id-section">
                <label for="client-id-input" class="block mb-1">1. Spotify Client ID:</label>
                <input type="text" id="client-id-input" placeholder="Enter your Spotify Client ID">
                <button id="save-client-id-button" title="Save Client ID to browser storage">[ Save ID ]</button>
                <button id="clear-client-id-button" title="Clear saved Client ID">[ Clear ]</button>
                <p id="client-id-status" class="info-message"></p>
            </div>

            <div class="input-section access-token-section">
                <label for="access-token-input" class="block mb-1">2. Access Token (Optional):</label>
                <input type="text" id="access-token-input" placeholder="Enter existing Access Token (optional)">
                 <p class="info-message">If provided, login will use this token directly.</p>
            </div>

            <p class="mb-2" id="login-prompt">Enter Client ID (and optionally Access Token), then Login.</p>
            <button id="login-button" class="button-style">[ Login / Connect ]</button>
            <p class="text-xs mt-2">(Requires Spotify Premium for playback control)</p>
        </div>

        <div id="player-section" style="display: none;">
            <div class="controls">
                <button id="prev-button" title="Previous Track" disabled>[ Prev ]</button>
                <button id="play-pause-button" title="Play/Pause" disabled>[ Play ]</button>
                <button id="next-button" title="Next Track" disabled>[ Next ]</button>
            </div>
            <div id="track-info" class="track-info">
                Connecting...
            </div>
            <div id="device-info" class="text-sm mt-2">
                Device: <span id="device-name"></span> (<span id="device-id"></span>)
            </div>
            <div id="token-footer" class="token-footer">
                Access Token: N/A
            </div>
        </div>

        <div id="error-message" class="error-message"></div>
    </div>

    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
        // --- Configuration ---
        // Client ID will be loaded from localStorage or input
        let clientId = null;
        const CLIENT_ID_STORAGE_KEY = 'spotifyMinimalPlayerClientId';
        // IMPORTANT: Replace with your actual Redirect URI registered in Spotify Dashboard
        const redirectUri = 'https://cadezawacki.github.io/sptfy.html';
        // IMPORTANT: Replace with actual Spotify API endpoints if needed
        const spotifyAuthorizeUrl = 'https://accounts.spotify.com/authorize'; // Standard Spotify Auth URL
        const spotifyPlayerApiUrl = 'https://api.spotify.com/v1/me/player'; // Standard Spotify Player API URL

        const scopes = [
            'streaming',            // Required for Web Playback SDK
            'user-read-email',      // Read user profile
            'user-read-private',    // Read user profile
            'user-read-playback-state', // Read playback state
            'user-modify-playback-state' // Control playback
        ].join(' ');

        // --- DOM Elements ---
        const loginSection = document.getElementById('login-section');
        const playerSection = document.getElementById('player-section');
        const loginButton = document.getElementById('login-button');
        const prevButton = document.getElementById('prev-button');
        const playPauseButton = document.getElementById('play-pause-button');
        const nextButton = document.getElementById('next-button');
        const trackInfoDiv = document.getElementById('track-info');
        const deviceInfoDiv = document.getElementById('device-info');
        const deviceNameSpan = document.getElementById('device-name');
        const deviceIdSpan = document.getElementById('device-id');
        const errorMessageDiv = document.getElementById('error-message');
        const clientIdInput = document.getElementById('client-id-input');
        const saveClientIdButton = document.getElementById('save-client-id-button');
        const clearClientIdButton = document.getElementById('clear-client-id-button');
        const clientIdStatus = document.getElementById('client-id-status');
        const loginPrompt = document.getElementById('login-prompt');
        const accessTokenInput = document.getElementById('access-token-input'); // New element
        const tokenFooterDiv = document.getElementById('token-footer'); // New element


        // --- Global Variables ---
        let player = null;
        let deviceId = null;
        let currentAccessToken = null;
        let isPlaying = false;
        let isSdkReady = false; // Flag to track if Spotify SDK is loaded
        let pendingInitializationToken = null; // Store token if login happens before SDK is ready

        // --- Functions ---

        /**
         * Displays an error message to the user.
         * @param {string} message - The error message to display.
         */
        function displayError(message) {
            console.error("Error:", message);
            errorMessageDiv.textContent = `Error: ${message}`;
        }

        /**
         * Clears any displayed error message.
         */
        function clearError() {
            errorMessageDiv.textContent = '';
        }

        /**
         * Updates the status message related to the Client ID.
         * @param {string} message - The message to display.
         * @param {boolean} isError - Optional: style as error if true.
         */
        function updateClientIdStatus(message, isError = false) {
            clientIdStatus.textContent = message;
            clientIdStatus.style.color = isError ? '#f56565' : '#a0aec0'; // Red for error, grey for info
        }

       /**
         * Updates the footer with the current access token.
         * WARNING: Displaying tokens is a security risk. For debugging/specific use only.
         * @param {string | null} token - The access token to display, or null.
         */
        function updateTokenFooter(token) {
            if (token) {
                 // WARNING: Displaying the access token directly in the UI is generally
                 //          a security risk. Use with caution or for debugging purposes only.
                tokenFooterDiv.textContent = `Access Token: ${token}`;
            } else {
                tokenFooterDiv.textContent = 'Access Token: N/A';
            }
        }


        /**
         * Loads Client ID from Local Storage.
         */
        function loadClientId() {
            try {
                const savedId = localStorage.getItem(CLIENT_ID_STORAGE_KEY);
                if (savedId) {
                    clientId = savedId;
                    clientIdInput.value = savedId;
                    updateClientIdStatus(`Loaded saved Client ID.`);
                    loginPrompt.textContent = "Client ID loaded. Enter optional token or Login.";
                    console.log("Client ID loaded from storage.");
                    return true; // Indicate success
                } else {
                    updateClientIdStatus("No Client ID saved. Please enter and save.");
                    loginPrompt.textContent = "Please enter and save your Client ID, then login.";
                    return false; // Indicate none found
                }
            } catch (e) {
                console.error("Could not access localStorage:", e);
                displayError("Could not access browser storage to load Client ID.");
                updateClientIdStatus("Could not load Client ID from storage.", true);
                return false; // Indicate failure
            }
        }

        /**
         * Saves Client ID to Local Storage.
         * @returns {boolean} True if saved successfully, false otherwise.
         */
        function saveClientId() {
            const enteredId = clientIdInput.value.trim();
            if (!enteredId) {
                updateClientIdStatus("Client ID cannot be empty.", true);
                return false;
            }
            try {
                localStorage.setItem(CLIENT_ID_STORAGE_KEY, enteredId);
                clientId = enteredId; // Update the global variable
                updateClientIdStatus("Client ID saved successfully.");
                loginPrompt.textContent = "Client ID saved. Enter optional token or Login.";
                console.log("Client ID saved to storage.");
                clearError(); // Clear previous errors if save is successful
                return true;
            } catch (e) {
                console.error("Could not access localStorage:", e);
                displayError("Could not access browser storage to save Client ID.");
                updateClientIdStatus("Failed to save Client ID to storage.", true);
                return false;
            }
        }

        /**
         * Clears Client ID from Local Storage.
         */
        function clearClientId() {
             try {
                localStorage.removeItem(CLIENT_ID_STORAGE_KEY);
                clientId = null; // Clear the global variable
                clientIdInput.value = ''; // Clear the input field
                updateClientIdStatus("Saved Client ID cleared.");
                loginPrompt.textContent = "Please enter and save your Client ID, then login.";
                console.log("Client ID cleared from storage.");
                clearError();
            } catch (e) {
                console.error("Could not access localStorage:", e);
                displayError("Could not access browser storage to clear Client ID.");
                updateClientIdStatus("Failed to clear Client ID from storage.", true);
            }
        }


        /**
         * Updates the UI with the current track information.
         * @param {object | null} state - The playback state object from the Spotify SDK, or null.
         */
        function updateUI(state) {
             if (!state) {
                // Handle cases where state is null (e.g., player not ready, disconnected)
                trackInfoDiv.textContent = player && deviceId ? "Player Ready. Select in Spotify." : "Player offline or initializing.";
                playPauseButton.textContent = '[ Play ]';
                playPauseButton.disabled = true;
                prevButton.disabled = true;
                nextButton.disabled = true;
                isPlaying = false;
                // Update device info even if state is null, if we have the info
                deviceNameSpan.textContent = player ? player._options.name : 'N/A';
                deviceIdSpan.textContent = deviceId || 'N/A';
                return;
            }

            const track = state.track_window.current_track;
            isPlaying = !state.paused;

            if (track) {
                const artists = track.artists.map(artist => artist.name).join(', ');
                trackInfoDiv.textContent = `${artists} - ${track.name}`;
            } else {
                trackInfoDiv.textContent = "No track loaded.";
            }

            playPauseButton.textContent = isPlaying ? '[ Pause ]' : '[ Play ]';
            // Enable controls once a valid state is received and device is active
            const isActive = state.device_id === deviceId;
            playPauseButton.disabled = !isActive;
            prevButton.disabled = !isActive || !state.track_window.previous_tracks.length;
            nextButton.disabled = !isActive || !state.track_window.next_tracks.length;

            // Update device info from the state
            deviceNameSpan.textContent = player ? player._options.name : 'N/A'; // Player name is from options
            deviceIdSpan.textContent = deviceId || 'N/A'; // Device ID comes from 'ready' or 'state_changed'
        }

        /**
         * Handles the Spotify authentication redirect callback.
         */
        function handleAuthenticationCallback() {
            loadClientId(); // Ensure Client ID is loaded if page was reloaded

            const params = new URLSearchParams(window.location.hash.substring(1));
            const accessToken = params.get('access_token');
            const error = params.get('error');

            // Clear the hash from the URL
            if (window.location.hash) {
                 history.pushState("", document.title, window.location.pathname + window.location.search);
            }


            if (error) {
                displayError(`Authentication failed: ${error}`);
                showLogin();
                return;
            }

            if (accessToken) {
                console.log("Access Token received via redirect.");
                currentAccessToken = accessToken;

                if (!clientId) {
                    // This case should ideally not happen if login was initiated correctly,
                    // but handle it defensively.
                    displayError("Logged in via redirect, but Client ID is missing. Please save it again.");
                    showLogin();
                } else {
                    // Successfully authenticated via redirect
                    showPlayer();
                    updateTokenFooter(currentAccessToken); // Display the new token
                    // Now, initialize the player if SDK is ready, or defer
                    if (isSdkReady) {
                        initializeSpotifyPlayer(currentAccessToken);
                    } else {
                        console.log("SDK not ready yet, deferring player initialization.");
                        pendingInitializationToken = currentAccessToken; // Store token for later
                    }
                }
            } else if (!currentAccessToken) {
                // No token in hash and no token provided directly earlier, show login
                showLogin();
            }
            // If currentAccessToken was set by direct input, handleAuthenticationCallback doesn't need to do anything else
        }

        /**
         * Redirects the user to Spotify's login page for authorization.
         */
        function redirectToSpotifyLogin() {
            clearError();

            // Ensure Client ID is available
            if (!clientId) {
                 displayError("Spotify Client ID is missing. Please enter and save it.");
                 updateClientIdStatus("Client ID is required before login.", true);
                 clientIdInput.focus();
                 return;
            }
             // Validate Redirect URI (basic check)
            if (!redirectUri || redirectUri === 'YOUR_REDIRECT_URI') {
                displayError("Spotify Redirect URI is not configured correctly in the code.");
                 // Avoid alert in production, but useful for development
                console.error("Developer Error: Configure redirectUri variable.");
                return;
            }

            // Construct the authorization URL
            const authUrl = `${spotifyAuthorizeUrl}?${new URLSearchParams({
                response_type: 'token',
                client_id: clientId,
                scope: scopes,
                redirect_uri: redirectUri,
                // show_dialog: 'true' // Optional: forces user to re-approve permissions
            })}`;

            console.log(`Redirecting to Spotify login with Client ID: ${clientId}`);
            window.location.href = authUrl; // Perform the redirect
        }

       /**
         * Initiates the login process based on user input.
         * Either uses a provided token or redirects for authorization.
         */
        function initiateLogin() {
            clearError();
            const enteredClientId = clientIdInput.value.trim();
            const enteredAccessToken = accessTokenInput.value.trim();

            // 1. Validate Client ID (must always be present)
            if (!enteredClientId) {
                displayError("Spotify Client ID is required.");
                updateClientIdStatus("Please enter your Client ID.", true);
                clientIdInput.focus();
                return;
            }
            // Use the entered Client ID (and save it if not already saved)
            if (enteredClientId !== clientId) {
                if (!saveClientId()) { // saveClientId updates global `clientId` if successful
                    // Saving failed, error message already shown by saveClientId
                    return;
                }
            }

            // 2. Check if an Access Token was provided
            if (enteredAccessToken) {
                console.log("Attempting login with provided Access Token.");
                currentAccessToken = enteredAccessToken;
                showPlayer();
                updateTokenFooter(currentAccessToken); // Show the provided token

                // Initialize player if SDK is ready, otherwise defer
                if (isSdkReady) {
                    initializeSpotifyPlayer(currentAccessToken);
                } else {
                    console.log("SDK not ready yet, deferring player initialization.");
                    pendingInitializationToken = currentAccessToken; // Store token
                }
            } else {
                // 3. No Access Token provided, proceed with standard redirect flow
                console.log("No Access Token provided, redirecting for Spotify authorization.");
                redirectToSpotifyLogin();
            }
        }


        /**
         * Shows the login section and hides the player.
         */
        function showLogin() {
            loginSection.style.display = 'block';
            playerSection.style.display = 'none';
            updateClientIdStatus(clientId ? "Client ID loaded." : "No Client ID saved."); // Refresh status
            updateTokenFooter(null); // Clear token footer
             // Clear token input field when going back to login
             accessTokenInput.value = '';
             currentAccessToken = null; // Clear token if we are back at login screen
             if (player) {
                console.log("Disconnecting player as returning to login screen.");
                player.disconnect();
                player = null;
                deviceId = null;
             }
        }

        /**
         * Shows the player section and hides the login section.
         */
        function showPlayer() {
            loginSection.style.display = 'none';
            playerSection.style.display = 'block';
            updateClientIdStatus(""); // Clear client ID status message
            clearError(); // Clear any login errors
        }

        /**
         * Initializes the Spotify Web Playback SDK Player.
         * This function is called by the SDK script once loaded.
         */
        window.onSpotifyWebPlaybackSDKReady = () => {
            console.log("Spotify SDK Ready.");
            isSdkReady = true;
            // If initialization was pending because the SDK wasn't ready, start it now
            if (pendingInitializationToken) {
                console.log("SDK is now ready, initializing player with pending token.");
                initializeSpotifyPlayer(pendingInitializationToken);
                pendingInitializationToken = null; // Clear the pending token
            }
        };

        /**
         * Creates and connects the Spotify Player instance.
         * @param {string} token - The Spotify Access Token.
         */
        function initializeSpotifyPlayer(token) {
             if (!token) {
                displayError("Cannot initialize player: Access token is missing.");
                showLogin();
                return;
            }
            if (!isSdkReady) {
                 displayError("Cannot initialize player: SDK is not ready yet.");
                 // Store the token to try again when SDK is ready
                 pendingInitializationToken = token;
                 return;
            }
             if (player) {
                console.log("Player already exists. Disconnecting previous instance before reconnecting.");
                player.disconnect();
                // Allow a brief moment for disconnection before creating new player
                // setTimeout(() => createAndConnectPlayer(token), 100); // Optional delay
                player = null; // Ensure old player reference is cleared
            }

            createAndConnectPlayer(token);
        }

        /**
         * Helper function to create and connect the player instance.
         * Separated to handle potential re-initialization.
         * @param {string} token - The Spotify Access Token.
         */
        function createAndConnectPlayer(token) {
            console.log("Initializing Spotify Player instance...");
            trackInfoDiv.textContent = "Initializing Player...";
            updateTokenFooter(token); // Ensure footer shows the token being used

            // Create the player instance
            player = new Spotify.Player({
                name: 'Minimal Web Player (Gemini)', // Give it a unique name
                getOAuthToken: cb => {
                    // This function provides the token to the SDK
                    console.log("SDK requesting OAuth token.");
                    // Check if the current token is still valid (basic check)
                    if (!currentAccessToken || currentAccessToken !== token) {
                        console.warn("Token mismatch or missing when SDK requested. Using provided token.");
                        // Potentially handle token refresh logic here in a real app
                        currentAccessToken = token; // Update if needed
                    }
                     // WARNING: Displaying the token here again is redundant but shows when SDK asks
                     console.log("Providing token to SDK:", currentAccessToken ? "********" : "null");
                    cb(currentAccessToken);
                },
                volume: 0.5 // Default volume
            });

            // --- Player Event Listeners ---
            player.addListener('initialization_error', ({ message }) => {
                displayError(`Initialization failed: ${message}. Ensure Spotify Premium and check console.`);
                showLogin(); // Go back to login on critical error
            });
            player.addListener('authentication_error', ({ message }) => {
                displayError(`Authentication failed: ${message}. Token might be expired or invalid.`);
                currentAccessToken = null; // Token is bad, clear it
                showLogin(); // Force re-login
            });
            player.addListener('account_error', ({ message }) => {
                // E.g., Premium required
                displayError(`Account error: ${message}. Spotify Premium might be required.`);
                // Don't necessarily force logout, user might fix account issue
            });
            player.addListener('playback_error', ({ message }) => {
                // E.g., Content restriction
                displayError(`Playback error: ${message}. Content might be restricted or unavailable.`);
            });

            // State changes (track change, play/pause, etc.)
            player.addListener('player_state_changed', (state) => {
                console.log('Player state changed:', state);
                clearError(); // Clear previous non-critical errors on state change
                if (!state) {
                    // State can be null if player disconnects or has an issue
                    displayError("Player state is null. Disconnected or issue occurred.");
                    updateUI(null); // Update UI to reflect offline state
                    // Consider if re-login should be forced here depending on cause
                    return;
                }
                // Update the global device ID if it changes (though usually set in 'ready')
                if (state.device_id) {
                    deviceId = state.device_id;
                }
                updateUI(state); // Update track info, buttons, etc.
            });

            // Player is ready to accept commands
            player.addListener('ready', ({ device_id }) => {
                console.log('Player ready with Device ID:', device_id);
                deviceId = device_id; // Store the device ID
                trackInfoDiv.textContent = "Player Ready. Select this device ('Minimal Web Player (Gemini)') in Spotify app.";
                updateUI(null); // Update UI elements like device info span
                // Optionally transfer playback automatically here if desired
                // transferPlayback(device_id);
            });

            // Player is not ready (e.g., disconnected)
            player.addListener('not_ready', ({ device_id }) => {
                console.log('Device ID has gone offline:', device_id);
                if (deviceId === device_id) { // Check if it's our device
                    deviceId = null;
                    displayError("Player has gone offline.");
                    updateUI(null); // Update UI to reflect offline state
                }
            });

            // --- Connect the Player ---
            player.connect().then(success => {
                if (success) {
                    console.log('Web Playback SDK successfully connected!');
                    trackInfoDiv.textContent = "Connected. Waiting for player ready...";
                } else {
                     console.error('Web Playback SDK failed to connect.');
                     displayError("Failed to connect the SDK. Check browser console (e.g., active device limit).");
                     // Don't necessarily force logout immediately, might be temporary
                     // showLogin();
                }
            }).catch(error => {
                 console.error('Error connecting player:', error);
                 displayError(`Connection error: ${error.message || error}. Check console.`);
                 showLogin(); // Force logout on connection error
            });
        }

         /**
         * Transfers playback to this web player.
         * @param {string} targetDeviceId - The device ID of this web player.
         */
        async function transferPlayback(targetDeviceId) {
            if (!currentAccessToken || !targetDeviceId) {
                console.warn("Cannot transfer playback: Missing token or device ID.");
                return;
            }
            console.log(`Requesting playback transfer to device ${targetDeviceId}`);
            try {
                const response = await fetch(spotifyPlayerApiUrl, { // Use standard API endpoint
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${currentAccessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        device_ids: [targetDeviceId],
                        play: false // Set to true to start playing immediately after transfer
                    }),
                });
                if (!response.ok) {
                    // Handle non-2xx responses (e.g., 401 Unauthorized, 403 Forbidden, 404 Not Found)
                    const errorBody = await response.text(); // Get error details if possible
                    throw new Error(`API Error ${response.status}: ${response.statusText}. ${errorBody}`);
                }
                console.log(`Playback transfer request successful to device ${targetDeviceId}`);
                // Playback state will update via the 'player_state_changed' listener
            } catch (error) {
                displayError(`Failed to transfer playback: ${error.message}`);
                console.error("Error transferring playback:", error);
            }
        }


        // --- Event Listeners ---
        saveClientIdButton.addEventListener('click', saveClientId);
        clearClientIdButton.addEventListener('click', clearClientId);

        // Optional: Save Client ID when pressing Enter in the input field
        clientIdInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                saveClientId();
            }
        });

        // Login button now calls initiateLogin
        loginButton.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default if it were a link
            initiateLogin();
        });

        // Player controls
        playPauseButton.addEventListener('click', () => {
            if (!player) return;
            player.togglePlay().catch(err => displayError(`Toggle play failed: ${err.message || err}`));
        });

        prevButton.addEventListener('click', () => {
            if (!player) return;
            player.previousTrack().catch(err => displayError(`Previous track failed: ${err.message || err}`));
        });

        nextButton.addEventListener('click', () => {
            if (!player) return;
            player.nextTrack().catch(err => displayError(`Next track failed: ${err.message || err}`));
        });

        // --- Initialization ---
        // Load Client ID and handle potential authentication callback on page load
        window.addEventListener('load', () => {
            loadClientId(); // Load Client ID first
            handleAuthenticationCallback(); // Check if we are returning from Spotify Auth
        });

    </script>
</body>
</html>
